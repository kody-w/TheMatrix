<!--
=============================================================================
FILE: team-builder.html
PURPOSE: Pokemon GO team composition and analysis tool for PvP battles
FEATURES:
  - Build teams of up to 6 Pokemon
  - Analyze type coverage across team
  - Identify team weaknesses and vulnerabilities
  - Suggest counters for common threats
  - Visual type effectiveness matrix
  - Save and load teams to local storage
  - Share teams via export/import
  - Role assignment (lead, safe swap, closer)
DEPENDENCIES:
  - Embedded Pokemon and type data (works offline)
  - Local storage for team persistence
  - Modern browser with ES6 support
USAGE:
  1. Add Pokemon to your team (up to 6)
  2. Assign roles (lead, safe swap, closer)
  3. Review type coverage analysis
  4. Check for weaknesses highlighted in red
  5. View suggested counters for your team
  6. Save team for future reference
  7. Export/import teams to share with others
USE CASES:
  - Creating balanced competitive PvP teams
  - Ensuring good type coverage
  - Preparing for specific meta threats
  - Team building for tournaments
  - Testing team synergy
CREATED: November 2024
LAST UPDATED: November 20, 2025
VERSION: 1.0
=============================================================================
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokemon Team Builder & Analyzer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5em;
            background: linear-gradient(135deg, #00d4ff, #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #a0a0a0;
            font-size: 0.95em;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
            color: #7c3aed;
        }

        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #444;
            border-top-color: #7c3aed;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(30, 30, 50, 0.8);
            border: 1px solid rgba(124, 58, 237, 0.3);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .card h2 {
            color: #00d4ff;
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 2px solid rgba(124, 58, 237, 0.3);
            padding-bottom: 10px;
        }

        .team-slots {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .team-slot {
            background: rgba(50, 50, 80, 0.6);
            border: 2px dashed rgba(124, 58, 237, 0.4);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 160px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .team-slot:hover {
            border-color: #7c3aed;
            background: rgba(50, 50, 80, 0.9);
        }

        .team-slot.filled {
            border-style: solid;
            border-color: #7c3aed;
            cursor: default;
        }

        .team-slot img {
            width: 80px;
            height: 80px;
            margin-bottom: 10px;
            image-rendering: pixelated;
        }

        .team-slot-name {
            font-weight: bold;
            color: #00d4ff;
            margin-bottom: 8px;
        }

        .team-slot-types {
            display: flex;
            gap: 5px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 8px;
        }

        .type-badge {
            font-size: 0.75em;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: bold;
            text-transform: capitalize;
        }

        .type-normal { background: #A8A878; color: white; }
        .type-fire { background: #F08030; color: white; }
        .type-water { background: #6890F0; color: white; }
        .type-grass { background: #78C850; color: white; }
        .type-electric { background: #F8D030; color: #333; }
        .type-ice { background: #98D8D8; color: #333; }
        .type-fighting { background: #C03028; color: white; }
        .type-poison { background: #A040A0; color: white; }
        .type-ground { background: #E0C068; color: #333; }
        .type-flying { background: #A890F0; color: white; }
        .type-psychic { background: #F85888; color: white; }
        .type-bug { background: #A8B820; color: white; }
        .type-rock { background: #B8A038; color: white; }
        .type-ghost { background: #705898; color: white; }
        .type-dragon { background: #7038F8; color: white; }
        .type-dark { background: #705848; color: white; }
        .type-steel { background: #B8B8D0; color: #333; }
        .type-fairy { background: #EE99AC; color: white; }

        .remove-btn {
            font-size: 0.8em;
            padding: 4px 8px;
            background: rgba(200, 50, 50, 0.6);
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: 0.2s;
        }

        .remove-btn:hover {
            background: rgba(255, 50, 50, 0.8);
        }

        .pokemon-search {
            margin-bottom: 15px;
        }

        .search-input {
            width: 100%;
            padding: 10px;
            background: rgba(50, 50, 80, 0.8);
            border: 1px solid rgba(124, 58, 237, 0.4);
            border-radius: 6px;
            color: #e0e0e0;
            font-size: 0.95em;
        }

        .search-input::placeholder {
            color: #707080;
        }

        .search-input:focus {
            outline: none;
            border-color: #7c3aed;
            box-shadow: 0 0 10px rgba(124, 58, 237, 0.3);
        }

        .pokemon-list {
            max-height: 400px;
            overflow-y: auto;
            display: grid;
            gap: 8px;
        }

        .pokemon-option {
            background: rgba(50, 50, 80, 0.6);
            padding: 10px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid transparent;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .pokemon-option:hover {
            background: rgba(124, 58, 237, 0.3);
            border-color: #7c3aed;
        }

        .pokemon-option img {
            width: 40px;
            height: 40px;
            image-rendering: pixelated;
        }

        .pokemon-option-name {
            flex: 1;
            font-weight: bold;
            color: #00d4ff;
        }

        .pokemon-option-types {
            display: flex;
            gap: 4px;
        }

        .analysis-grid {
            display: grid;
            gap: 20px;
        }

        .heatmap-container {
            background: rgba(30, 30, 50, 0.8);
            border: 1px solid rgba(124, 58, 237, 0.3);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .heatmap-container h3 {
            color: #00d4ff;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .heatmap {
            display: grid;
            grid-template-columns: repeat(18, 1fr);
            gap: 4px;
            margin-bottom: 15px;
        }

        .heatmap-cell {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            font-size: 0.7em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .heatmap-cell:hover {
            transform: scale(1.1);
            border-color: rgba(255, 255, 255, 0.5);
            box-shadow: 0 0 10px rgba(124, 58, 237, 0.5);
            z-index: 10;
        }

        .heatmap-label {
            font-size: 0.75em;
            text-align: center;
            color: #808080;
            margin-top: 5px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .coverage-legend {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            font-size: 0.85em;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 30px;
            height: 20px;
            border-radius: 4px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .stat-box {
            background: rgba(50, 50, 80, 0.6);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #7c3aed;
        }

        .stat-label {
            color: #a0a0a0;
            font-size: 0.9em;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #00d4ff;
        }

        .weakness-resistance-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .weakness-box, .resistance-box {
            background: rgba(50, 50, 80, 0.6);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #7c3aed;
        }

        .weakness-box {
            border-left-color: #ff6b6b;
        }

        .resistance-box {
            border-left-color: #51cf66;
        }

        .title {
            color: #00d4ff;
            font-size: 0.95em;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .type-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .threat-score-container {
            margin-top: 20px;
        }

        .threat-item {
            background: rgba(50, 50, 80, 0.6);
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .threat-pokemon {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .threat-pokemon img {
            width: 32px;
            height: 32px;
            image-rendering: pixelated;
        }

        .threat-pokemon-name {
            color: #00d4ff;
            font-weight: bold;
        }

        .threat-score {
            background: linear-gradient(135deg, #ff6b6b, #ff922b);
            padding: 4px 10px;
            border-radius: 4px;
            font-weight: bold;
            color: white;
            font-size: 0.9em;
        }

        .synergy-container {
            margin-top: 20px;
        }

        .synergy-item {
            background: rgba(50, 50, 80, 0.6);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #51cf66;
        }

        .synergy-score {
            color: #00d4ff;
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 8px;
        }

        .synergy-reason {
            color: #a0a0a0;
            font-size: 0.9em;
            line-height: 1.4;
        }

        .safe-swap-container {
            margin-top: 20px;
        }

        .safe-swap-item {
            background: rgba(50, 50, 80, 0.6);
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-left: 4px solid #51cf66;
        }

        .safe-swap-pokemon {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
        }

        .safe-swap-pokemon img {
            width: 32px;
            height: 32px;
            image-rendering: pixelated;
        }

        .safe-swap-name {
            color: #00d4ff;
            font-weight: bold;
        }

        .safe-swap-badge {
            background: #51cf66;
            color: #1a1a2e;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .counter-suggestions {
            margin-top: 20px;
        }

        .counter-item {
            background: rgba(50, 50, 80, 0.6);
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 8px;
            border-left: 4px solid #51cf66;
        }

        .counter-weakness {
            color: #ff6b6b;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .counter-pokemon {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #00d4ff;
        }

        .counter-pokemon img {
            width: 28px;
            height: 28px;
            image-rendering: pixelated;
        }

        .export-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .export-btn {
            flex: 1;
            padding: 10px;
            background: linear-gradient(135deg, #7c3aed, #00d4ff);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            font-size: 0.95em;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(124, 58, 237, 0.4);
        }

        .export-btn:active {
            transform: translateY(0);
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #707080;
        }

        .empty-state-icon {
            font-size: 2.5em;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }

            .team-slots {
                grid-template-columns: repeat(3, 1fr);
            }

            .heatmap {
                grid-template-columns: repeat(9, 1fr);
            }

            h1 {
                font-size: 1.8em;
            }
        }

        @media (max-width: 768px) {
            .team-slots {
                grid-template-columns: 1fr;
            }

            .heatmap {
                grid-template-columns: repeat(6, 1fr);
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .weakness-resistance-grid {
                grid-template-columns: 1fr;
            }
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            margin: 10% auto;
            padding: 20px;
            border: 1px solid rgba(124, 58, 237, 0.3);
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-close {
            color: #a0a0a0;
            float: right;
            font-size: 2em;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
        }

        .modal-close:hover {
            color: #00d4ff;
        }

        .scrollbar {
            scrollbar-width: thin;
            scrollbar-color: rgba(124, 58, 237, 0.4) transparent;
        }

        .scrollbar::-webkit-scrollbar {
            width: 8px;
        }

        .scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }

        .scrollbar::-webkit-scrollbar-thumb {
            background: rgba(124, 58, 237, 0.4);
            border-radius: 4px;
        }

        .scrollbar::-webkit-scrollbar-thumb:hover {
            background: rgba(124, 58, 237, 0.6);
        }

        .section-divider {
            height: 1px;
            background: rgba(124, 58, 237, 0.2);
            margin: 20px 0;
        }

        .info-text {
            color: #808080;
            font-size: 0.85em;
            margin-top: 10px;
            line-height: 1.4;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Team Builder & Analyzer</h1>
            <p class="subtitle">Build and analyze 3-Pokemon teams with comprehensive coverage, synergy, and threat analysis</p>
        </header>

        <div id="loading" class="loading">
            <span class="spinner"></span>
            Loading Pokemon data...
        </div>

        <div id="content" style="display: none;">
            <div class="main-grid">
                <!-- Team Selector -->
                <div class="card">
                    <h2>Your Team</h2>
                    <div class="team-slots" id="teamSlots">
                        <div class="team-slot" data-slot="0">
                            <div class="empty-state">
                                <div class="empty-state-icon">+</div>
                                <div>Click to add Pokemon</div>
                            </div>
                        </div>
                        <div class="team-slot" data-slot="1">
                            <div class="empty-state">
                                <div class="empty-state-icon">+</div>
                                <div>Click to add Pokemon</div>
                            </div>
                        </div>
                        <div class="team-slot" data-slot="2">
                            <div class="empty-state">
                                <div class="empty-state-icon">+</div>
                                <div>Click to add Pokemon</div>
                            </div>
                        </div>
                    </div>
                    <div class="export-controls">
                        <button class="export-btn" id="exportBtn">Export Team</button>
                        <button class="export-btn" id="resetBtn">Reset Team</button>
                    </div>
                    <div class="info-text">Select 3 Pokemon to see team analysis. You can click on any slot to change the Pokemon.</div>
                </div>

                <!-- Pokemon Selector -->
                <div class="card">
                    <h2>Select Pokemon</h2>
                    <div class="pokemon-search">
                        <input type="text" class="search-input scrollbar" id="pokemonSearch" placeholder="Search by name or type...">
                    </div>
                    <div class="pokemon-list scrollbar" id="pokemonList"></div>
                </div>
            </div>

            <!-- Analysis Section -->
            <div class="analysis-grid" id="analysisSection" style="display: none;">
                <!-- Type Coverage Heatmap -->
                <div class="heatmap-container">
                    <h3>Type Coverage Heatmap</h3>
                    <p class="info-text">Shows how your team covers offensive (rows) and defensive (columns) type matchups. Darker = better coverage.</p>
                    <div class="heatmap" id="coverageHeatmap"></div>
                    <div class="coverage-legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: rgba(255, 100, 100, 0.8);"></div>
                            <span>No coverage (0)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: rgba(200, 150, 100, 0.8);"></div>
                            <span>Partial (1-2)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: rgba(100, 200, 100, 0.8);"></div>
                            <span>Good (3)</span>
                        </div>
                    </div>
                </div>

                <!-- Weakness & Resistance Analysis -->
                <div class="card">
                    <h2>Team Weaknesses & Resistances</h2>
                    <div class="weakness-resistance-grid">
                        <div class="weakness-box">
                            <div class="title">Team Weaknesses</div>
                            <div class="type-list" id="teamWeaknesses"></div>
                        </div>
                        <div class="resistance-box">
                            <div class="title">Team Resistances</div>
                            <div class="type-list" id="teamResistances"></div>
                        </div>
                    </div>
                    <div class="info-text">Weaknesses are types that at least 2 team members are weak to. Resistances apply to all team members.</div>
                </div>

                <!-- Team Synergy -->
                <div class="card">
                    <h2>Team Synergy</h2>
                    <div class="synergy-container" id="synergyContainer"></div>
                </div>

                <!-- Threat Score -->
                <div class="card">
                    <h2>Threat Score vs Meta Pokemon</h2>
                    <p class="info-text">Shows how your team fares against the 15 most common meta Pokemon. Higher = better matchup.</p>
                    <div class="threat-score-container" id="threatScoreContainer"></div>
                </div>

                <!-- Safe Swap Analysis -->
                <div class="card">
                    <h2>Safe Swap Identification</h2>
                    <p class="info-text">Shows which Pokemon in your team can safely switch without getting hard-countered.</p>
                    <div class="safe-swap-container" id="safeSwapContainer"></div>
                </div>

                <!-- Counter Suggestions -->
                <div class="card">
                    <h2>Counter Suggestions</h2>
                    <p class="info-text">Suggested Pokemon from your team that can counter the weaknesses you're exposed to.</p>
                    <div class="counter-suggestions" id="counterSuggestions"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Pokemon Selection Modal -->
    <div id="pokemonModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" id="modalClose">&times;</span>
            <h2 style="color: #00d4ff; margin-bottom: 15px;">Search Pokemon</h2>
            <input type="text" class="search-input scrollbar" id="modalSearch" placeholder="Search by name...">
            <div class="pokemon-list scrollbar" id="modalPokemonList" style="margin-top: 15px;"></div>
        </div>
    </div>

    <script>
        // Type effectiveness matrix for Pokemon GO
        const typeEffectiveness = {
            normal: { rock: 0.625, ghost: 0.390625, steel: 0.625 },
            fire: { fire: 0.625, water: 0.625, grass: 1.6, ice: 1.6, bug: 1.6, steel: 1.6 },
            water: { fire: 1.6, water: 0.625, grass: 0.625, ground: 1.6 },
            grass: { fire: 0.625, water: 1.6, grass: 0.625, ice: 0.625, poison: 0.625, ground: 1.6, flying: 0.625, bug: 0.625 },
            electric: { water: 1.6, grass: 0.625, electric: 0.625, flying: 1.6, ground: 0.390625 },
            ice: { fire: 0.625, water: 0.625, grass: 1.6, ice: 0.625, dragon: 1.6, flying: 1.6 },
            fighting: { normal: 1.6, ice: 1.6, rock: 1.6, dark: 1.6, steel: 1.6, flying: 0.625, poison: 0.625, psychic: 0.625, bug: 0.625, ghost: 0.390625 },
            poison: { grass: 1.6, fairy: 1.6, poison: 0.625, ground: 0.625, rock: 0.625, ghost: 0.625, steel: 0.390625 },
            ground: { fire: 1.6, electric: 1.6, poison: 1.6, rock: 1.6, grass: 0.625, flying: 0.390625, bug: 0.625 },
            flying: { fighting: 1.6, bug: 1.6, grass: 1.6, rock: 0.625, steel: 0.625, electric: 0.625 },
            psychic: { fighting: 1.6, poison: 1.6, psychic: 0.625, dark: 0.390625, steel: 0.625 },
            bug: { fire: 0.625, flying: 0.625, rock: 0.625, grass: 1.6, psychic: 1.6, dark: 1.6, steel: 0.625, poison: 0.625, ghost: 0.625 },
            rock: { fire: 1.6, ice: 1.6, flying: 1.6, bug: 1.6, normal: 0.625, poison: 0.625, ground: 0.625, steel: 0.625 },
            ghost: { psychic: 1.6, ghost: 1.6, normal: 0.390625, dark: 0.625 },
            dragon: { dragon: 1.6, steel: 0.625 },
            dark: { psychic: 1.6, ghost: 1.6, dark: 0.625, fighting: 0.625, fairy: 0.625 },
            steel: { fire: 0.625, water: 0.625, electric: 0.625, ice: 1.6, rock: 1.6, flying: 1.6, grass: 0.625, psychic: 1.6, bug: 1.6, rock: 1.6, ghost: 0.625, dragon: 1.6, steel: 0.625, fairy: 1.6, normal: 1.6, poison: 1.6 },
            fairy: { fighting: 1.6, dark: 1.6, poison: 0.625, steel: 0.625, flying: 0.625, fire: 0.625 }
        };

        // Common meta Pokemon for threat scoring (tier list sample)
        const metaPokemon = [
            { name: 'Trevenant', dex: 709, types: ['ghost', 'grass'] },
            { name: 'Alolan Muk', dex: 89, types: ['poison', 'dark'] },
            { name: 'Jellicent', dex: 593, types: ['water', 'ghost'] },
            { name: 'Cresselia', dex: 488, types: ['psychic'] },
            { name: 'Venusaur', dex: 3, types: ['grass', 'poison'] },
            { name: 'Registeel', dex: 379, types: ['steel'] },
            { name: 'Typhlosion', dex: 157, types: ['fire'] },
            { name: 'Walrein', dex: 365, types: ['water', 'ice'] },
            { name: 'Obstagoon', dex: 899, types: ['normal', 'dark'] },
            { name: 'Azumarill', dex: 184, types: ['water', 'fairy'] },
            { name: 'Umbreon', dex: 197, types: ['dark'] },
            { name: 'Articuno', dex: 144, types: ['ice', 'flying'] },
            { name: 'Scizor', dex: 212, types: ['bug', 'steel'] },
            { name: 'Dragonite', dex: 149, types: ['dragon', 'flying'] },
            { name: 'Gyarados', dex: 130, types: ['water', 'flying'] }
        ];

        const types = ['normal', 'fire', 'water', 'grass', 'electric', 'ice', 'fighting', 'poison', 'ground', 'flying', 'psychic', 'bug', 'rock', 'ghost', 'dragon', 'dark', 'steel', 'fairy'];

        let gamemaster = null;
        let pokemonData = [];
        let team = [null, null, null];
        let selectedSlot = null;

        // Initialize
        async function initialize() {
            try {
                await loadGamemaster();
                setupEventListeners();
                renderPokemonList();
                document.getElementById('loading').style.display = 'none';
                document.getElementById('content').style.display = 'block';
            } catch (error) {
                console.error('Initialization error:', error);
                document.getElementById('loading').innerHTML = 'Error loading data. Please refresh the page.';
            }
        }

        // Load gamemaster data
        async function loadGamemaster() {
            const response = await fetch('https://raw.githubusercontent.com/pvpoke/pvpoke/master/src/data/gamemaster.json');
            gamemaster = await response.json();
            pokemonData = gamemaster.pokemon.filter(p => p.released).slice(0, 500);
        }

        // Setup event listeners
        function setupEventListeners() {
            document.getElementById('pokemonSearch').addEventListener('input', filterPokemonList);
            document.getElementById('resetBtn').addEventListener('click', resetTeam);
            document.getElementById('exportBtn').addEventListener('click', exportTeam);
            document.getElementById('modalClose').addEventListener('click', closeModal);
            document.getElementById('modalSearch').addEventListener('input', filterModalPokemonList);

            document.querySelectorAll('.team-slot').forEach(slot => {
                slot.addEventListener('click', () => openPokemonSelector(parseInt(slot.dataset.slot)));
            });
        }

        // Render initial Pokemon list
        function renderPokemonList() {
            const list = document.getElementById('pokemonList');
            list.innerHTML = pokemonData.slice(0, 50).map(p => createPokemonOption(p)).join('');
            list.querySelectorAll('.pokemon-option').forEach(option => {
                option.addEventListener('click', () => selectPokemon(parseInt(option.dataset.dex), selectedSlot));
            });
        }

        // Filter Pokemon list
        function filterPokemonList(e) {
            const query = e.target.value.toLowerCase();
            const filtered = pokemonData.filter(p =>
                p.speciesName.toLowerCase().includes(query) ||
                p.types.some(t => t.includes(query))
            ).slice(0, 50);

            const list = document.getElementById('pokemonList');
            list.innerHTML = filtered.length > 0
                ? filtered.map(p => createPokemonOption(p)).join('')
                : '<div style="text-align: center; color: #707080; padding: 20px;">No Pokemon found</div>';

            list.querySelectorAll('.pokemon-option').forEach(option => {
                option.addEventListener('click', () => selectPokemon(parseInt(option.dataset.dex), selectedSlot));
            });
        }

        // Filter modal Pokemon list
        function filterModalPokemonList(e) {
            const query = e.target.value.toLowerCase();
            const filtered = pokemonData.filter(p =>
                p.speciesName.toLowerCase().includes(query)
            ).slice(0, 100);

            const list = document.getElementById('modalPokemonList');
            list.innerHTML = filtered.length > 0
                ? filtered.map(p => createPokemonOption(p)).join('')
                : '<div style="text-align: center; color: #707080; padding: 20px;">No Pokemon found</div>';

            list.querySelectorAll('.pokemon-option').forEach(option => {
                option.addEventListener('click', () => selectPokemon(parseInt(option.dataset.dex), selectedSlot));
            });
        }

        // Create Pokemon option element
        function createPokemonOption(pokemon) {
            return `
                <div class="pokemon-option" data-dex="${pokemon.dex}">
                    <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${pokemon.dex}.png" alt="${pokemon.speciesName}">
                    <div class="pokemon-option-name">${pokemon.speciesName}</div>
                    <div class="pokemon-option-types">
                        ${pokemon.types.map(t => `<span class="type-badge type-${t}">${t}</span>`).join('')}
                    </div>
                </div>
            `;
        }

        // Open Pokemon selector
        function openPokemonSelector(slot) {
            selectedSlot = slot;
            const modal = document.getElementById('pokemonModal');
            modal.style.display = 'block';
            document.getElementById('modalSearch').value = '';
            filterModalPokemonList({ target: { value: '' } });
        }

        // Close modal
        function closeModal() {
            document.getElementById('pokemonModal').style.display = 'none';
        }

        window.onclick = function(event) {
            const modal = document.getElementById('pokemonModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        };

        // Select Pokemon
        function selectPokemon(dex, slot) {
            const pokemon = pokemonData.find(p => p.dex === dex);
            if (pokemon) {
                team[slot] = pokemon;
                updateTeamDisplay();
                updateAnalysis();
                closeModal();
            }
        }

        // Update team display
        function updateTeamDisplay() {
            document.querySelectorAll('.team-slot').forEach((slot, idx) => {
                const pokemon = team[idx];
                if (pokemon) {
                    slot.classList.add('filled');
                    slot.innerHTML = `
                        <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${pokemon.dex}.png" alt="${pokemon.speciesName}">
                        <div class="team-slot-name">${pokemon.speciesName}</div>
                        <div class="team-slot-types">
                            ${pokemon.types.map(t => `<span class="type-badge type-${t}">${t}</span>`).join('')}
                        </div>
                        <button class="remove-btn" onclick="removePokemon(${idx})">Remove</button>
                    `;
                } else {
                    slot.classList.remove('filled');
                    slot.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">+</div>
                            <div>Click to add Pokemon</div>
                        </div>
                    `;
                }
                slot.addEventListener('click', () => openPokemonSelector(idx));
            });
        }

        // Remove Pokemon
        window.removePokemon = function(slot) {
            team[slot] = null;
            updateTeamDisplay();
            updateAnalysis();
        };

        // Update analysis
        function updateAnalysis() {
            const analysisSection = document.getElementById('analysisSection');
            if (team.some(p => p !== null)) {
                analysisSection.style.display = 'grid';
                updateCoverageHeatmap();
                updateWeaknessResistance();
                updateTeamSynergy();
                updateThreatScore();
                updateSafeSwap();
                updateCounterSuggestions();
            } else {
                analysisSection.style.display = 'none';
            }
        }

        // Update coverage heatmap
        function updateCoverageHeatmap() {
            const heatmap = document.getElementById('coverageHeatmap');
            heatmap.innerHTML = '';

            const coverage = {};
            types.forEach(offType => {
                coverage[offType] = {};
                types.forEach(defType => {
                    let count = 0;
                    team.forEach(p => {
                        if (p) {
                            p.types.forEach(t => {
                                if (typeEffectiveness[offType] && typeEffectiveness[offType][defType] && typeEffectiveness[offType][defType] > 1) {
                                    count++;
                                }
                            });
                        }
                    });
                    coverage[offType][defType] = count;
                }
            });

            types.forEach(offType => {
                types.forEach(defType => {
                    const count = coverage[offType][defType];
                    let bgColor = 'rgba(255, 100, 100, 0.4)';
                    if (count === 1) bgColor = 'rgba(200, 150, 100, 0.6)';
                    if (count === 2) bgColor = 'rgba(150, 180, 100, 0.7)';
                    if (count === 3) bgColor = 'rgba(100, 200, 100, 0.8)';

                    const cell = document.createElement('div');
                    cell.className = 'heatmap-cell';
                    cell.style.background = bgColor;
                    cell.title = `${offType} vs ${defType}: ${count} Pokemon resist`;
                    cell.textContent = count > 0 ? count : 'â—‹';
                    heatmap.appendChild(cell);
                });
            });

            // Add type labels
            const labels = document.createElement('div');
            labels.style.display = 'grid';
            labels.style.gridTemplateColumns = 'repeat(18, 1fr)';
            labels.style.gap = '4px';
            labels.style.marginBottom = '10px';

            types.forEach(type => {
                const label = document.createElement('div');
                label.className = 'heatmap-label';
                label.textContent = type.substring(0, 3).toUpperCase();
                labels.appendChild(label);
            });

            document.querySelector('.heatmap-container').insertBefore(labels, heatmap);
        }

        // Update weakness/resistance
        function updateWeaknessResistance() {
            const weaknesses = {};
            const resistances = {};

            // Count weaknesses
            team.forEach(p => {
                if (p) {
                    p.types.forEach(t => {
                        types.forEach(atk => {
                            if (typeEffectiveness[atk] && typeEffectiveness[atk][t] && typeEffectiveness[atk][t] > 1) {
                                weaknesses[atk] = (weaknesses[atk] || 0) + 1;
                            }
                        });
                    });
                }
            });

            // Count resistances (must resist in all team members)
            if (team.every(p => p !== null)) {
                types.forEach(defType => {
                    let resistCount = 0;
                    team.forEach(p => {
                        p.types.forEach(t => {
                            if (typeEffectiveness[defType] && typeEffectiveness[defType][t] && typeEffectiveness[defType][t] < 1) {
                                resistCount++;
                            }
                        });
                    });
                    if (resistCount > 0) {
                        resistances[defType] = resistCount;
                    }
                });
            }

            // Render weaknesses (2+ Pokemon weak to it)
            const weaknessHtml = Object.entries(weaknesses)
                .filter(([_, count]) => count >= 2)
                .map(([type]) => `<span class="type-badge type-${type}">${type}</span>`)
                .join('');
            document.getElementById('teamWeaknesses').innerHTML = weaknessHtml || '<span style="color: #707080;">No shared weaknesses</span>';

            // Render resistances
            const resistanceHtml = Object.entries(resistances)
                .map(([type]) => `<span class="type-badge type-${type}">${type}</span>`)
                .join('');
            document.getElementById('teamResistances').innerHTML = resistanceHtml || '<span style="color: #707080;">No resistances</span>';
        }

        // Update team synergy
        function updateTeamSynergy() {
            const container = document.getElementById('synergyContainer');
            const synergyScores = {};

            team.forEach((p1, idx1) => {
                if (!p1) return;
                let score = 0;
                let reasons = [];

                team.forEach((p2, idx2) => {
                    if (idx2 <= idx1 || !p2) return;

                    // Check type coverage complementarity
                    p1.types.forEach(t1 => {
                        p2.types.forEach(t2 => {
                            if (typeEffectiveness[t1] && typeEffectiveness[t1][t2]) {
                                const eff = typeEffectiveness[t1][t2];
                                if (eff > 1) score += 2;
                                if (eff < 1) score += 1;
                            }
                        });
                    });

                    // Check shared type vulnerabilities
                    const p1Weaknesses = new Set();
                    const p2Weaknesses = new Set();

                    p1.types.forEach(t => {
                        types.forEach(atk => {
                            if (typeEffectiveness[atk] && typeEffectiveness[atk][t] && typeEffectiveness[atk][t] > 1) {
                                p1Weaknesses.add(atk);
                            }
                        });
                    });

                    p2.types.forEach(t => {
                        types.forEach(atk => {
                            if (typeEffectiveness[atk] && typeEffectiveness[atk][t] && typeEffectiveness[atk][t] > 1) {
                                p2Weaknesses.add(atk);
                            }
                        });
                    });

                    const sharedWeaknesses = new Set([...p1Weaknesses].filter(x => p2Weaknesses.has(x)));
                    if (sharedWeaknesses.size === 0) {
                        score += 5;
                        reasons.push(`${p1.speciesName} and ${p2.speciesName} don't share weaknesses`);
                    }
                });

                if (score > 0) {
                    synergyScores[p1.speciesName] = { score, reasons };
                }
            });

            container.innerHTML = Object.entries(synergyScores)
                .map(([name, { score, reasons }]) => `
                    <div class="synergy-item">
                        <div class="synergy-score">Synergy Score: ${score}/10</div>
                        <div class="synergy-reason">${reasons.length > 0 ? reasons[0] : 'Good type coverage'}</div>
                    </div>
                `)
                .join('');

            if (Object.keys(synergyScores).length === 0) {
                container.innerHTML = '<div style="color: #707080; text-align: center; padding: 20px;">Add more Pokemon to see synergy analysis</div>';
            }
        }

        // Update threat score
        function updateThreatScore() {
            const container = document.getElementById('threatScoreContainer');
            const scores = [];

            metaPokemon.forEach(meta => {
                let score = 0;
                team.forEach(p => {
                    if (!p) return;

                    // Calculate type advantage
                    p.types.forEach(t => {
                        meta.types.forEach(mt => {
                            if (typeEffectiveness[t] && typeEffectiveness[t][mt]) {
                                const eff = typeEffectiveness[t][mt];
                                if (eff > 1) score += 2;
                                if (eff < 1) score -= 1;
                            }
                        });
                    });
                });

                scores.push({ name: meta.name, dex: meta.dex, score: Math.max(0, score) });
            });

            scores.sort((a, b) => b.score - a.score);

            container.innerHTML = scores.slice(0, 10).map(s => `
                <div class="threat-item">
                    <div class="threat-pokemon">
                        <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${s.dex}.png" alt="${s.name}">
                        <div class="threat-pokemon-name">${s.name}</div>
                    </div>
                    <div class="threat-score">${s.score}</div>
                </div>
            `).join('');
        }

        // Update safe swap
        function updateSafeSwap() {
            const container = document.getElementById('safeSwapContainer');
            const safeSwaps = [];

            team.forEach((p, idx) => {
                if (!p) return;

                let isSafe = true;
                metaPokemon.slice(0, 5).forEach(meta => {
                    meta.types.forEach(mt => {
                        p.types.forEach(pt => {
                            if (typeEffectiveness[mt] && typeEffectiveness[mt][pt] && typeEffectiveness[mt][pt] > 1.5) {
                                isSafe = false;
                            }
                        });
                    });
                });

                if (isSafe) {
                    safeSwaps.push({ pokemon: p, slot: idx });
                }
            });

            container.innerHTML = safeSwaps.length > 0
                ? safeSwaps.map(s => `
                    <div class="safe-swap-item">
                        <div class="safe-swap-pokemon">
                            <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${s.pokemon.dex}.png" alt="${s.pokemon.speciesName}">
                            <div class="safe-swap-name">${s.pokemon.speciesName}</div>
                        </div>
                        <div class="safe-swap-badge">Safe</div>
                    </div>
                `).join('')
                : '<div style="color: #707080; text-align: center; padding: 20px;">No guaranteed safe swaps against current meta</div>';
        }

        // Update counter suggestions
        function updateCounterSuggestions() {
            const container = document.getElementById('counterSuggestions');
            const weaknesses = {};

            team.forEach(p => {
                if (p) {
                    p.types.forEach(t => {
                        types.forEach(atk => {
                            if (typeEffectiveness[atk] && typeEffectiveness[atk][t] && typeEffectiveness[atk][t] > 1) {
                                weaknesses[atk] = (weaknesses[atk] || 0) + 1;
                            }
                        });
                    });
                }
            });

            const majorWeaknesses = Object.entries(weaknesses)
                .filter(([_, count]) => count >= 2)
                .map(([type]) => type);

            if (majorWeaknesses.length === 0) {
                container.innerHTML = '<div style="color: #707080; text-align: center; padding: 20px;">No major weaknesses to counter</div>';
                return;
            }

            const suggestions = [];
            majorWeaknesses.forEach(weakness => {
                const counters = pokemonData.filter(p => {
                    return p.types.some(t => {
                        return typeEffectiveness[t] && typeEffectiveness[t][weakness] && typeEffectiveness[t][weakness] > 1;
                    });
                }).slice(0, 2);

                if (counters.length > 0) {
                    suggestions.push({
                        weakness,
                        counters
                    });
                }
            });

            container.innerHTML = suggestions.map(s => `
                <div class="counter-item">
                    <div class="counter-weakness">Weakness to ${s.weakness}:</div>
                    ${s.counters.map(c => `
                        <div class="counter-pokemon">
                            <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${c.dex}.png" alt="${c.speciesName}">
                            <span>${c.speciesName} (${c.types.join('/')})</span>
                        </div>
                    `).join('')}
                </div>
            `).join('');
        }

        // Reset team
        function resetTeam() {
            team = [null, null, null];
            updateTeamDisplay();
            updateAnalysis();
        }

        // Export team
        function exportTeam() {
            if (!team.some(p => p !== null)) {
                alert('Please add at least one Pokemon to your team');
                return;
            }

            const teamInfo = team
                .filter(p => p !== null)
                .map(p => `${p.speciesName} (${p.types.join('/')})\nATK: ${p.baseStats.atk} | DEF: ${p.baseStats.def} | HP: ${p.baseStats.hp}`)
                .join('\n\n');

            const exportText = `Pokemon Team Builder Export\n${'='.repeat(50)}\n\nTeam:\n${teamInfo}\n\n${'='.repeat(50)}\nExported: ${new Date().toLocaleString()}`;

            const blob = new Blob([exportText], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'pokemon-team.txt';
            a.click();
            window.URL.revokeObjectURL(url);
        }

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', initialize);
    </script>
</body>
</html>
