<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Type Effectiveness Matrix - Pokemon Battle Assistant</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #00d4ff;
        }

        header h1 {
            font-size: 2.5em;
            color: #00d4ff;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }

        header p {
            color: #b0b0b0;
            font-size: 1.1em;
        }

        /* Tab Navigation */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            border-bottom: 2px solid #00d4ff;
        }

        .tab-button {
            padding: 10px 20px;
            background: rgba(0, 212, 255, 0.1);
            border: 2px solid #00d4ff;
            color: #00d4ff;
            cursor: pointer;
            border-radius: 5px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .tab-button:hover {
            background: rgba(0, 212, 255, 0.2);
            transform: translateY(-2px);
        }

        .tab-button.active {
            background: #00d4ff;
            color: #1a1a2e;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Type Effectiveness Matrix */
        .matrix-container {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #00d4ff;
            overflow-x: auto;
            margin-bottom: 20px;
        }

        .type-matrix {
            display: grid;
            gap: 2px;
            min-width: fit-content;
            grid-template-columns: 60px repeat(18, 50px);
        }

        .matrix-header {
            background: #00d4ff;
            color: #1a1a2e;
            padding: 8px;
            text-align: center;
            font-weight: bold;
            font-size: 0.85em;
            border-radius: 3px;
            min-height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            word-break: break-word;
        }

        .matrix-row-label {
            background: #00d4ff;
            color: #1a1a2e;
            padding: 8px;
            text-align: center;
            font-weight: bold;
            font-size: 0.85em;
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .matrix-cell {
            padding: 8px;
            text-align: center;
            font-weight: bold;
            cursor: pointer;
            border-radius: 3px;
            min-height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
            transition: all 0.2s ease;
            position: relative;
        }

        .matrix-cell:hover {
            transform: scale(1.1);
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
            z-index: 10;
        }

        /* Type effectiveness colors */
        .super-effective {
            background: rgba(76, 175, 80, 0.8);
            color: #fff;
            border: 1px solid #4CAF50;
        }

        .not-very-effective {
            background: rgba(244, 67, 54, 0.8);
            color: #fff;
            border: 1px solid #f44336;
        }

        .immune {
            background: rgba(156, 39, 176, 0.8);
            color: #fff;
            border: 1px solid #9c27b0;
        }

        .neutral {
            background: rgba(100, 100, 100, 0.6);
            color: #e0e0e0;
            border: 1px solid #666;
        }

        /* Modal/Popup */
        .cell-detail {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(26, 26, 46, 0.95);
            border: 2px solid #00d4ff;
            border-radius: 10px;
            padding: 30px;
            max-width: 400px;
            z-index: 1000;
            display: none;
            box-shadow: 0 0 30px rgba(0, 212, 255, 0.3);
        }

        .cell-detail.active {
            display: block;
        }

        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            z-index: 999;
        }

        .modal-backdrop.active {
            display: block;
        }

        .cell-detail h3 {
            color: #00d4ff;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .cell-detail p {
            margin: 10px 0;
            line-height: 1.6;
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: #00d4ff;
            color: #1a1a2e;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-weight: bold;
        }

        /* Tools Section */
        .tool-section {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #00d4ff;
            margin-bottom: 20px;
        }

        .tool-section h3 {
            color: #00d4ff;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .type-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .type-btn {
            padding: 10px;
            border: 2px solid #00d4ff;
            background: rgba(0, 212, 255, 0.1);
            color: #00d4ff;
            cursor: pointer;
            border-radius: 5px;
            font-weight: bold;
            transition: all 0.3s ease;
            text-transform: capitalize;
        }

        .type-btn:hover,
        .type-btn.selected {
            background: #00d4ff;
            color: #1a1a2e;
        }

        .results-box {
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 5px;
            border-left: 3px solid #00d4ff;
            margin-top: 15px;
        }

        .results-box h4 {
            color: #00d4ff;
            margin-bottom: 10px;
        }

        .type-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 8px;
            margin-top: 10px;
        }

        .type-badge {
            padding: 8px;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
            font-size: 0.9em;
            text-transform: capitalize;
        }

        .type-badge.effective {
            background: rgba(76, 175, 80, 0.6);
            color: #fff;
        }

        .type-badge.weak {
            background: rgba(244, 67, 54, 0.6);
            color: #fff;
        }

        .type-badge.resist {
            background: rgba(33, 150, 243, 0.6);
            color: #fff;
        }

        .type-badge.immune {
            background: rgba(156, 39, 176, 0.6);
            color: #fff;
        }

        .type-badge.neutral {
            background: rgba(100, 100, 100, 0.6);
            color: #e0e0e0;
        }

        /* Statistics Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid #00d4ff;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
        }

        .stat-card h4 {
            color: #00d4ff;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 1.5em;
            font-weight: bold;
            color: #fff;
        }

        /* Input Fields */
        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #00d4ff;
            font-weight: bold;
        }

        .input-group input,
        .input-group select {
            width: 100%;
            padding: 10px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #00d4ff;
            color: #e0e0e0;
            border-radius: 5px;
            font-size: 1em;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }

        /* Coverage Grid */
        .coverage-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .coverage-item {
            background: rgba(0, 0, 0, 0.5);
            padding: 12px;
            border-radius: 5px;
            border-left: 3px solid #00d4ff;
        }

        .coverage-item .type-name {
            color: #00d4ff;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .coverage-item .multipliers {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .multiplier-badge {
            background: rgba(0, 212, 255, 0.2);
            border: 1px solid #00d4ff;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 0.85em;
            color: #00d4ff;
        }

        /* Loading State */
        .loading {
            text-align: center;
            color: #00d4ff;
            padding: 20px;
        }

        .spinner {
            border: 3px solid rgba(0, 212, 255, 0.3);
            border-top: 3px solid #00d4ff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8em;
            }

            .type-matrix {
                grid-template-columns: 50px repeat(18, 35px);
                gap: 1px;
            }

            .matrix-cell {
                font-size: 0.7em;
                min-height: 35px;
                padding: 4px;
            }

            .tabs {
                gap: 5px;
            }

            .tab-button {
                padding: 8px 12px;
                font-size: 0.9em;
            }

            .type-selector {
                grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            }
        }

        .error-message {
            background: rgba(244, 67, 54, 0.2);
            border: 1px solid #f44336;
            color: #ff6b6b;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Type Effectiveness Matrix</h1>
            <p>Analyze Pokemon type matchups, coverage, and strategic advantages</p>
        </header>

        <!-- Tab Navigation -->
        <div class="tabs">
            <button class="tab-button active" onclick="showTab('matrix')">Type Matrix</button>
            <button class="tab-button" onclick="showTab('single-type')">Single-Type Lookup</button>
            <button class="tab-button" onclick="showTab('dual-type')">Dual-Type Calculator</button>
            <button class="tab-button" onclick="showTab('coverage')">Coverage Checker</button>
            <button class="tab-button" onclick="showTab('best-types')">Best Types</button>
            <button class="tab-button" onclick="showTab('resistance')">Triple Resistance</button>
            <button class="tab-button" onclick="showTab('stab')">STAB Calculator</button>
        </div>

        <!-- Tab 1: Interactive Type Matrix -->
        <div id="matrix" class="tab-content active">
            <div class="tool-section">
                <h3>18x18 Type Effectiveness Matrix</h3>
                <p style="color: #b0b0b0; margin-bottom: 15px;">Click any cell to see detailed multiplier information</p>
                <div class="matrix-container">
                    <div class="type-matrix" id="typeMatrix"></div>
                </div>
            </div>
        </div>

        <!-- Tab 2: Single-Type Lookup -->
        <div id="single-type" class="tab-content">
            <div class="tool-section">
                <h3>Single-Type Effectiveness Lookup</h3>
                <div class="input-group">
                    <label>Select Type to Analyze:</label>
                    <div class="type-selector" id="singleTypeSelector"></div>
                </div>
                <div id="singleTypeResults"></div>
            </div>
        </div>

        <!-- Tab 3: Dual-Type Calculator -->
        <div id="dual-type" class="tab-content">
            <div class="tool-section">
                <h3>Dual-Type Effectiveness Calculator</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="input-group">
                        <label>Primary Type:</label>
                        <div class="type-selector" id="primaryTypeSelector" style="grid-template-columns: repeat(2, 1fr);"></div>
                    </div>
                    <div class="input-group">
                        <label>Secondary Type:</label>
                        <div class="type-selector" id="secondaryTypeSelector" style="grid-template-columns: repeat(2, 1fr);"></div>
                    </div>
                </div>
                <div id="dualTypeResults"></div>
            </div>
        </div>

        <!-- Tab 4: Coverage Checker -->
        <div id="coverage" class="tab-content">
            <div class="tool-section">
                <h3>Coverage Checker</h3>
                <p style="color: #b0b0b0; margin-bottom: 15px;">Select moves to see what types your Pokemon can hit effectively</p>
                <div class="input-group">
                    <label>Select Move Types (Hold Ctrl to select multiple):</label>
                    <div class="type-selector" id="coverageTypeSelector"></div>
                </div>
                <div id="coverageResults"></div>
            </div>
        </div>

        <!-- Tab 5: Best Types -->
        <div id="best-types" class="tab-content">
            <div class="tool-section">
                <h3>Best Offensive & Defensive Type Combinations</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <h4>Best Offensive Coverage</h4>
                        <p style="font-size: 0.9em; color: #b0b0b0; margin-bottom: 10px;">Types that hit most other types super effectively</p>
                        <div id="bestOffensive"></div>
                    </div>
                    <div class="stat-card">
                        <h4>Best Defensive Coverage</h4>
                        <p style="font-size: 0.9em; color: #b0b0b0; margin-bottom: 10px;">Types with most resistances</p>
                        <div id="bestDefensive"></div>
                    </div>
                    <div class="stat-card">
                        <h4>Best Balanced Types</h4>
                        <p style="font-size: 0.9em; color: #b0b0b0; margin-bottom: 10px;">Good both offensively and defensively</p>
                        <div id="bestBalanced"></div>
                    </div>
                    <div class="stat-card">
                        <h4>Type with Most Coverage</h4>
                        <p style="font-size: 0.9em; color: #b0b0b0; margin-bottom: 10px;">Types that cover the most other types</p>
                        <div id="mostCoverage"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab 6: Triple Resistance Finder -->
        <div id="resistance" class="tab-content">
            <div class="tool-section">
                <h3>Triple Resistance Finder (0.244x Damage)</h3>
                <p style="color: #b0b0b0; margin-bottom: 15px;">Find type combinations that resist multiple types to reach 0.244x multiplier (1/2 × 1/2)</p>
                <button class="tab-button" onclick="findTripleResistances()" style="margin-bottom: 20px;">Find Best Defensive Combos</button>
                <div id="tripleResistanceResults"></div>
            </div>
        </div>

        <!-- Tab 7: STAB Calculator -->
        <div id="stab" class="tab-content">
            <div class="tool-section">
                <h3>STAB (Same Type Attack Bonus) Calculator</h3>
                <p style="color: #b0b0b0; margin-bottom: 15px;">Calculate move damage with STAB multiplier (1.6x for same type moves)</p>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="input-group">
                        <label>Pokemon Type(s):</label>
                        <div class="type-selector" id="stabTypeSelector"></div>
                    </div>
                    <div class="input-group">
                        <label>Move Type:</label>
                        <div class="type-selector" id="stabMoveSelector"></div>
                    </div>
                </div>
                <div id="stabResults"></div>
            </div>
        </div>
    </div>

    <!-- Modal for cell details -->
    <div class="modal-backdrop" id="modalBackdrop" onclick="closeModal()"></div>
    <div class="cell-detail" id="cellDetail">
        <button class="close-btn" onclick="closeModal()">×</button>
        <h3 id="cellDetailTitle"></h3>
        <div id="cellDetailContent"></div>
    </div>

    <script>
        // Type Effectiveness Data (18 Pokemon types)
        const TYPES = ['normal', 'fire', 'water', 'electric', 'grass', 'ice', 'fighting', 'poison', 'ground', 'flying', 'psychic', 'bug', 'rock', 'ghost', 'dragon', 'dark', 'steel', 'fairy'];

        // Type effectiveness multipliers
        const TYPE_EFFECTIVENESS = {
            normal: { rock: 0.625, ghost: 0.390625, steel: 0.625 },
            fire: { fire: 0.625, water: 0.625, grass: 1.6, ice: 1.6, bug: 1.6, steel: 1.6, fairy: 1.6, ground: 0.625, rock: 0.625 },
            water: { fire: 1.6, water: 0.625, grass: 0.625, ground: 1.6, rock: 1.6, ice: 1.6, steel: 1.6 },
            electric: { water: 1.6, grass: 0.625, flying: 1.6, electric: 0.625, steel: 1.6, ground: 0.625 },
            grass: { water: 1.6, ground: 1.6, rock: 1.6, fire: 0.625, grass: 0.625, poison: 0.625, flying: 0.625, bug: 0.625, steel: 0.625 },
            ice: { flying: 1.6, ground: 1.6, grass: 1.6, dragon: 1.6, fire: 0.625, ice: 0.625, water: 0.625, steel: 0.625 },
            fighting: { normal: 1.6, rock: 1.6, steel: 1.6, ice: 1.6, dark: 1.6, flying: 0.625, psychic: 0.625, fairy: 0.625 },
            poison: { grass: 1.6, fairy: 1.6, poison: 0.625, ground: 0.625, rock: 0.625, ghost: 0.625, steel: 0.390625 },
            ground: { fire: 1.6, electric: 1.6, poison: 1.6, rock: 1.6, steel: 1.6, grass: 0.625, bug: 0.625, flying: 0.390625 },
            flying: { fighting: 1.6, bug: 1.6, grass: 1.6, rock: 0.625, steel: 0.625, electric: 0.625 },
            psychic: { fighting: 1.6, poison: 1.6, dark: 0.625, psychic: 0.625, steel: 0.625 },
            bug: { grass: 1.6, psychic: 1.6, dark: 1.6, fire: 0.625, fighting: 0.625, poison: 0.625, flying: 0.625, ghost: 0.625, steel: 0.625, fairy: 0.625 },
            rock: { fire: 1.6, ice: 1.6, flying: 1.6, bug: 1.6, steel: 0.625, fighting: 0.625, grass: 0.625, ground: 0.625 },
            ghost: { psychic: 1.6, ghost: 1.6, dark: 0.625, normal: 0.390625 },
            dragon: { dragon: 1.6, steel: 0.625, fairy: 0.625 },
            dark: { psychic: 1.6, ghost: 1.6, dark: 0.625, fighting: 0.625, fairy: 0.625 },
            steel: { ice: 1.6, rock: 1.6, fairy: 1.6, fire: 0.625, water: 0.625, electric: 0.625, grass: 0.625, psychic: 0.625, bug: 0.625, rock: 0.625, normal: 0.625, flying: 0.625, steel: 0.625, grass: 0.625, ice: 0.625, dragon: 1.6, steel: 0.625, fairy: 1.6, poison: 0.390625 },
            fairy: { fighting: 1.6, dark: 1.6, dragon: 1.6, fire: 0.625, poison: 0.625, steel: 0.625 }
        };

        // Ensure all types have an effectiveness entry
        TYPES.forEach(type => {
            if (!TYPE_EFFECTIVENESS[type]) {
                TYPE_EFFECTIVENESS[type] = {};
            }
        });

        // Get multiplier for defender against attacker
        function getMultiplier(attackType, defendType) {
            const multipliers = TYPE_EFFECTIVENESS[attackType] || {};
            return multipliers[defendType] || 1.0;
        }

        // Classify multiplier
        function classifyMultiplier(mult) {
            if (mult >= 1.6) return 'super-effective';
            if (mult <= 0.625) return 'not-very-effective';
            if (mult <= 0.390625) return 'immune';
            return 'neutral';
        }

        // Get multiplier description
        function describeMultiplier(mult) {
            if (mult >= 1.6) return `Super Effective (${(mult * 100).toFixed(0)}% damage)`;
            if (mult === 1.0) return 'Neutral (100% damage)';
            if (mult > 0.625 && mult < 1.0) return `Not Very Effective (${(mult * 100).toFixed(0)}% damage)`;
            if (mult > 0.390625 && mult <= 0.625) return `Not Very Effective (${(mult * 100).toFixed(0)}% damage)`;
            if (mult <= 0.390625) return `Immune (${(mult * 100).toFixed(1)}% damage)`;
            return `Not Very Effective (${(mult * 100).toFixed(0)}% damage)`;
        }

        // Initialize the type matrix
        function initTypeMatrix() {
            const matrix = document.getElementById('typeMatrix');
            matrix.innerHTML = '';

            // Header row
            let html = '<div class="matrix-header"></div>';
            TYPES.forEach(type => {
                html += `<div class="matrix-header">${type.toUpperCase()}</div>`;
            });

            // Data rows
            TYPES.forEach(defenderType => {
                html += `<div class="matrix-row-label">${defenderType.toUpperCase()}</div>`;
                TYPES.forEach(attackerType => {
                    const mult = getMultiplier(attackerType, defenderType);
                    const className = classifyMultiplier(mult);
                    html += `<div class="matrix-cell ${className}" onclick="showCellDetail('${attackerType}', '${defenderType}')" title="${describeMultiplier(mult)}">
                        ${(mult === 1.0 ? '-' : (mult >= 1.6 ? '✓' : (mult <= 0.625 ? '×' : '○')))}
                    </div>`;
                });
            });

            matrix.innerHTML = html;
        }

        // Show cell detail modal
        function showCellDetail(attackType, defendType) {
            const mult = getMultiplier(attackType, defendType);
            const title = document.getElementById('cellDetailTitle');
            const content = document.getElementById('cellDetailContent');

            title.textContent = `${attackType.toUpperCase()} attacking ${defendType.toUpperCase()}`;

            let effectText = '';
            if (mult >= 1.6) {
                effectText = `<span style="color: #4CAF50;">SUPER EFFECTIVE</span> - Dealing 1.6× damage`;
            } else if (mult === 1.0) {
                effectText = `<span style="color: #888;">NEUTRAL</span> - Dealing normal damage`;
            } else if (mult > 0.625) {
                effectText = `<span style="color: #f44336;">NOT VERY EFFECTIVE</span> - Dealing ${(mult * 100).toFixed(0)}% damage`;
            } else if (mult > 0.390625) {
                effectText = `<span style="color: #f44336;">NOT VERY EFFECTIVE</span> - Dealing ${(mult * 100).toFixed(0)}% damage`;
            } else {
                effectText = `<span style="color: #9c27b0;">IMMUNE</span> - Dealing only ${(mult * 100).toFixed(1)}% damage`;
            }

            content.innerHTML = `
                <p><strong>Multiplier:</strong> ${mult}×</p>
                <p><strong>Effect:</strong></p>
                <p>${effectText}</p>
                <p><strong>Explanation:</strong> A ${attackType} attack hitting a ${defendType} type Pokemon deals ${(mult * 100).toFixed(0)}% of normal damage.</p>
            `;

            document.getElementById('modalBackdrop').classList.add('active');
            document.getElementById('cellDetail').classList.add('active');
        }

        function closeModal() {
            document.getElementById('modalBackdrop').classList.remove('active');
            document.getElementById('cellDetail').classList.remove('active');
        }

        // Tab switching
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            // Remove active from all buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName).classList.add('active');

            // Add active to clicked button
            event.target.classList.add('active');

            // Initialize content if needed
            if (tabName === 'single-type' && !document.getElementById('singleTypeResults').innerHTML) {
                initSingleTypeSelector();
            }
            if (tabName === 'dual-type' && !document.getElementById('dualTypeResults').innerHTML) {
                initDualTypeSelector();
            }
            if (tabName === 'coverage' && !document.getElementById('coverageResults').innerHTML) {
                initCoverageSelector();
            }
            if (tabName === 'best-types' && !document.getElementById('bestOffensive').innerHTML) {
                calculateBestTypes();
            }
            if (tabName === 'stab' && !document.getElementById('stabResults').innerHTML) {
                initSTABSelector();
            }
        }

        // Single-Type Lookup
        function initSingleTypeSelector() {
            const selector = document.getElementById('singleTypeSelector');
            selector.innerHTML = TYPES.map(type =>
                `<button class="type-btn" onclick="analyzeSingleType('${type}')">${type}</button>`
            ).join('');
        }

        function analyzeSingleType(type) {
            const results = document.getElementById('singleTypeResults');

            const superEffectiveAgainst = [];
            const notVeryEffectiveAgainst = [];
            const immuneTo = [];
            const resistsTo = [];
            const weakTo = [];
            const immuteToAttacks = [];

            TYPES.forEach(targetType => {
                const mult = getMultiplier(type, targetType);
                if (mult >= 1.6) superEffectiveAgainst.push(targetType);
                else if (mult < 1.0 && mult > 0.390625) notVeryEffectiveAgainst.push(targetType);
                else if (mult <= 0.390625) immuneTo.push(targetType);
            });

            // Defense analysis - what does this type resist/weak to?
            TYPES.forEach(attackType => {
                const mult = getMultiplier(attackType, type);
                if (mult < 1.0) resistsTo.push({ type: attackType, mult: mult });
                else if (mult >= 1.6) weakTo.push({ type: attackType, mult: mult });
                else if (mult <= 0.390625) immuteToAttacks.push(attackType);
            });

            results.innerHTML = `
                <div class="results-box">
                    <h4>Offensive Coverage (${type.toUpperCase()} attacking):</h4>
                    <p><strong>Super Effective Against:</strong></p>
                    <div class="type-list">${superEffectiveAgainst.length > 0 ? superEffectiveAgainst.map(t => `<div class="type-badge effective">${t}</div>`).join('') : '<span style="color: #888;">None</span>'}</div>
                </div>

                <div class="results-box">
                    <p><strong>Weak To:</strong></p>
                    <div class="type-list">${weakTo.length > 0 ? weakTo.map(w => `<div class="type-badge weak">${w.type} (${(w.mult * 100).toFixed(0)}%)</div>`).join('') : '<span style="color: #888;">None</span>'}</div>
                </div>

                <div class="results-box">
                    <h4>Defensive Coverage (${type.toUpperCase()} defending):</h4>
                    <p><strong>Resists:</strong></p>
                    <div class="type-list">${resistsTo.length > 0 ? resistsTo.map(r => `<div class="type-badge resist">${r.type} (${(r.mult * 100).toFixed(0)}%)</div>`).join('') : '<span style="color: #888;">None</span>'}</div>
                </div>

                <div class="results-box">
                    <p><strong>Immune To:</strong></p>
                    <div class="type-list">${immuteToAttacks.length > 0 ? immuteToAttacks.map(t => `<div class="type-badge immune">${t}</div>`).join('') : '<span style="color: #888;">None</span>'}</div>
                </div>
            `;
        }

        // Dual-Type Calculator
        function initDualTypeSelector() {
            const primary = document.getElementById('primaryTypeSelector');
            const secondary = document.getElementById('secondaryTypeSelector');

            primary.innerHTML = TYPES.map(type =>
                `<button class="type-btn" onclick="updateDualType()">${type}</button>`
            ).join('');

            secondary.innerHTML = TYPES.map(type =>
                `<button class="type-btn" onclick="updateDualType()">${type}</button>`
            ).join('');
        }

        function updateDualType() {
            const primaryBtn = document.querySelector('#primaryTypeSelector .type-btn.selected');
            const secondaryBtn = document.querySelector('#secondaryTypeSelector .type-btn.selected');

            if (!primaryBtn || !secondaryBtn) {
                document.getElementById('dualTypeResults').innerHTML = '<p style="color: #888;">Select both types to analyze</p>';
                return;
            }

            const primary = primaryBtn.textContent.toLowerCase();
            const secondary = secondaryBtn.textContent.toLowerCase();

            const results = document.getElementById('dualTypeResults');

            const superEffectiveAgainst = [];
            const resistsTo = [];
            const weakTo = [];
            const immuneTo = [];

            // Offensive coverage
            TYPES.forEach(targetType => {
                const mult1 = getMultiplier(primary, targetType);
                const mult2 = getMultiplier(secondary, targetType);
                const combined = mult1 * mult2;

                if (combined >= 1.6) superEffectiveAgainst.push({ type: targetType, mult: combined });
            });

            // Defensive coverage
            TYPES.forEach(attackType => {
                const mult1 = getMultiplier(attackType, primary);
                const mult2 = getMultiplier(attackType, secondary);
                const combined = (mult1 + mult2) / 2;

                if (combined < 1.0) {
                    resistsTo.push({ type: attackType, mult: combined });
                } else if (combined >= 1.6) {
                    weakTo.push({ type: attackType, mult: combined });
                }

                if (mult1 <= 0.390625 || mult2 <= 0.390625) {
                    immuneTo.push(attackType);
                }
            });

            results.innerHTML = `
                <div class="results-box">
                    <h4>${primary.toUpperCase()}/${secondary.toUpperCase()} - Offensive Coverage:</h4>
                    <p><strong>Super Effective Against (1.6x+):</strong></p>
                    <div class="type-list">${superEffectiveAgainst.length > 0 ? superEffectiveAgainst.map(t => `<div class="type-badge effective">${t.type} (${(t.mult * 100).toFixed(0)}%)</div>`).join('') : '<span style="color: #888;">None</span>'}</div>
                </div>

                <div class="results-box">
                    <h4>Defensive Coverage:</h4>
                    <p><strong>Weak To:</strong></p>
                    <div class="type-list">${weakTo.length > 0 ? weakTo.map(w => `<div class="type-badge weak">${w.type}</div>`).join('') : '<span style="color: #888;">None</span>'}</div>
                </div>

                <div class="results-box">
                    <p><strong>Resists:</strong></p>
                    <div class="type-list">${resistsTo.length > 0 ? resistsTo.map(r => `<div class="type-badge resist">${r.type}</div>`).join('') : '<span style="color: #888;">None</span>'}</div>
                </div>
            `;
        }

        // Make type buttons selectable
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('type-btn')) {
                const parent = e.target.parentElement;
                if (parent.id === 'primaryTypeSelector' || parent.id === 'secondaryTypeSelector') {
                    parent.querySelectorAll('.type-btn').forEach(btn => btn.classList.remove('selected'));
                    e.target.classList.add('selected');
                } else if (parent.id === 'singleTypeSelector') {
                    // Allow single select
                    parent.querySelectorAll('.type-btn').forEach(btn => btn.classList.remove('selected'));
                    e.target.classList.add('selected');
                } else if (parent.id === 'coverageTypeSelector') {
                    // Allow multiple select
                    e.target.classList.toggle('selected');
                } else if (parent.id === 'stabTypeSelector' || parent.id === 'stabMoveSelector') {
                    parent.querySelectorAll('.type-btn').forEach(btn => btn.classList.remove('selected'));
                    e.target.classList.add('selected');
                }
            }
        });

        // Coverage Checker
        function initCoverageSelector() {
            const selector = document.getElementById('coverageTypeSelector');
            selector.innerHTML = TYPES.map(type =>
                `<button class="type-btn" onclick="">${type}</button>`
            ).join('');
        }

        function checkCoverage() {
            const selected = Array.from(document.querySelectorAll('#coverageTypeSelector .type-btn.selected')).map(btn => btn.textContent.toLowerCase());

            if (selected.length === 0) {
                document.getElementById('coverageResults').innerHTML = '<p style="color: #888;">Select at least one move type</p>';
                return;
            }

            const results = document.getElementById('coverageResults');
            const coverageMap = {};

            TYPES.forEach(defenderType => {
                let maxMult = 1.0;
                selected.forEach(moveType => {
                    const mult = getMultiplier(moveType, defenderType);
                    maxMult = Math.max(maxMult, mult);
                });
                coverageMap[defenderType] = maxMult;
            });

            const superEffective = Object.entries(coverageMap).filter(([t, m]) => m >= 1.6);
            const neutral = Object.entries(coverageMap).filter(([t, m]) => m === 1.0);
            const notVeryEffective = Object.entries(coverageMap).filter(([t, m]) => m < 1.6 && m > 0.390625);

            results.innerHTML = `
                <div class="results-box">
                    <h4>Coverage Summary:</h4>
                    <p>Selected types: ${selected.join(', ').toUpperCase()}</p>
                    <p>Super Effective Coverage: ${superEffective.length}/18 types</p>
                </div>

                <div class="results-box">
                    <h4>Super Effective Against:</h4>
                    <div class="type-list">${superEffective.map(([t, m]) => `<div class="type-badge effective">${t}</div>`).join('')}</div>
                </div>

                <div class="results-box">
                    <h4>Neutral Against:</h4>
                    <div class="type-list">${neutral.map(([t]) => `<div class="type-badge neutral">${t}</div>`).join('')}</div>
                </div>
            `;
        }

        // Add coverage checker listener
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('type-btn') && e.target.parentElement.id === 'coverageTypeSelector') {
                setTimeout(checkCoverage, 50);
            }
        });

        // Best Types Analysis
        function calculateBestTypes() {
            const results = {};

            TYPES.forEach(type => {
                let offensiveCoverage = 0;
                let defensiveResists = 0;
                let defensiveWeaknesses = 0;

                TYPES.forEach(targetType => {
                    const offensiveMult = getMultiplier(type, targetType);
                    const defensiveMult = getMultiplier(targetType, type);

                    if (offensiveMult >= 1.6) offensiveCoverage++;
                    if (defensiveMult < 1.0 && defensiveMult > 0) defensiveResists++;
                    if (defensiveMult >= 1.6) defensiveWeaknesses++;
                });

                results[type] = {
                    offensiveCoverage,
                    defensiveResists,
                    defensiveWeaknesses,
                    balance: offensiveCoverage + defensiveResists - defensiveWeaknesses
                };
            });

            const bestOffensive = Object.entries(results).sort((a, b) => b[1].offensiveCoverage - a[1].offensiveCoverage).slice(0, 5);
            const bestDefensive = Object.entries(results).sort((a, b) => b[1].defensiveResists - a[1].defensiveResists).slice(0, 5);
            const bestBalanced = Object.entries(results).sort((a, b) => b[1].balance - a[1].balance).slice(0, 5);

            document.getElementById('bestOffensive').innerHTML = bestOffensive.map(([t, v]) =>
                `<div style="font-size: 1.1em; margin: 5px 0;"><strong>${t.toUpperCase()}</strong> (${v.offensiveCoverage} coverage)</div>`
            ).join('');

            document.getElementById('bestDefensive').innerHTML = bestDefensive.map(([t, v]) =>
                `<div style="font-size: 1.1em; margin: 5px 0;"><strong>${t.toUpperCase()}</strong> (${v.defensiveResists} resists)</div>`
            ).join('');

            document.getElementById('bestBalanced').innerHTML = bestBalanced.map(([t, v]) =>
                `<div style="font-size: 1.1em; margin: 5px 0;"><strong>${t.toUpperCase()}</strong> (${v.balance} balance score)</div>`
            ).join('');

            // Type with most coverage
            const totalCoverage = {};
            TYPES.forEach(attackType => {
                let covered = 0;
                TYPES.forEach(defendType => {
                    if (getMultiplier(attackType, defendType) >= 1.6) covered++;
                });
                totalCoverage[attackType] = covered;
            });

            const mostCoverageTpes = Object.entries(totalCoverage).sort((a, b) => b[1] - a[1]).slice(0, 5);
            document.getElementById('mostCoverage').innerHTML = mostCoverageTpes.map(([t, v]) =>
                `<div style="font-size: 1.1em; margin: 5px 0;"><strong>${t.toUpperCase()}</strong> (${v} types hit)</div>`
            ).join('');
        }

        // Triple Resistance Finder
        function findTripleResistances() {
            const results = document.getElementById('tripleResistanceResults');
            const dualCombos = [];

            TYPES.forEach(type1 => {
                TYPES.slice(TYPES.indexOf(type1)).forEach(type2 => {
                    if (type1 === type2) return;

                    const resistances = [];
                    TYPES.forEach(attackType => {
                        const mult1 = getMultiplier(attackType, type1);
                        const mult2 = getMultiplier(attackType, type2);
                        const combined = Math.min(mult1, mult2);

                        if (combined <= 0.625) {
                            resistances.push({ type: attackType, mult: combined });
                        }
                    });

                    if (resistances.length >= 3) {
                        dualCombos.push({
                            combo: `${type1}/${type2}`,
                            resistances: resistances.sort((a, b) => a.mult - b.mult)
                        });
                    }
                });
            });

            dualCombos.sort((a, b) => b.resistances.length - a.resistances.length);

            results.innerHTML = dualCombos.slice(0, 10).map(combo => `
                <div class="results-box">
                    <h4>${combo.combo.toUpperCase()} - ${combo.resistances.length} Resistances</h4>
                    <div class="type-list">${combo.resistances.map(r =>
                        `<div class="type-badge resist">${r.type} (${(r.mult * 100).toFixed(1)}%)</div>`
                    ).join('')}</div>
                </div>
            `).join('');
        }

        // STAB Calculator
        function initSTABSelector() {
            const typeSelector = document.getElementById('stabTypeSelector');
            const moveSelector = document.getElementById('stabMoveSelector');

            typeSelector.innerHTML = TYPES.map(type =>
                `<button class="type-btn" onclick="updateSTAB()">${type}</button>`
            ).join('');

            moveSelector.innerHTML = TYPES.map(type =>
                `<button class="type-btn" onclick="updateSTAB()">${type}</button>`
            ).join('');
        }

        function updateSTAB() {
            const typeBtn = document.querySelector('#stabTypeSelector .type-btn.selected');
            const moveBtn = document.querySelector('#stabMoveSelector .type-btn.selected');

            if (!typeBtn || !moveBtn) {
                document.getElementById('stabResults').innerHTML = '<p style="color: #888;">Select both Pokemon type and move type</p>';
                return;
            }

            const pokemonType = typeBtn.textContent.toLowerCase();
            const moveType = moveBtn.textContent.toLowerCase();

            const hasSTAB = pokemonType === moveType;
            const stabMultiplier = hasSTAB ? 1.6 : 1.0;

            const results = document.getElementById('stabResults');

            let html = `
                <div class="results-box">
                    <h4>STAB Analysis</h4>
                    <p><strong>Pokemon Type:</strong> ${pokemonType.toUpperCase()}</p>
                    <p><strong>Move Type:</strong> ${moveType.toUpperCase()}</p>
                    <p><strong>STAB Eligible:</strong> ${hasSTAB ? '<span style="color: #4CAF50;">YES</span>' : '<span style="color: #f44336;">NO</span>'}</p>
                    <p><strong>Damage Multiplier:</strong> ${stabMultiplier}×</p>
                </div>

                <div class="results-box">
                    <h4>${moveType.toUpperCase()} Move Effectiveness (with ${hasSTAB ? 'STAB' : 'no STAB'}):</h4>
            `;

            TYPES.forEach(defendType => {
                const baseMult = getMultiplier(moveType, defendType);
                const finalMult = baseMult * stabMultiplier;
                const classification = classifyMultiplier(baseMult);

                html += `<div style="margin: 8px 0; padding: 8px; background: rgba(0, 212, 255, 0.1); border-radius: 3px;">
                    <strong>${defendType.toUpperCase()}:</strong> ${baseMult}× × ${stabMultiplier}× = <span style="color: #00d4ff; font-weight: bold;">${finalMult}×</span>
                </div>`;
            });

            html += `</div>`;
            results.innerHTML = html;
        }

        // Add dual type select listener
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('type-btn')) {
                const parent = e.target.parentElement;
                if (parent.id === 'primaryTypeSelector' || parent.id === 'secondaryTypeSelector') {
                    parent.querySelectorAll('.type-btn').forEach(btn => btn.classList.remove('selected'));
                    e.target.classList.add('selected');
                    setTimeout(updateDualType, 50);
                } else if (parent.id === 'stabTypeSelector' || parent.id === 'stabMoveSelector') {
                    parent.querySelectorAll('.type-btn').forEach(btn => btn.classList.remove('selected'));
                    e.target.classList.add('selected');
                    setTimeout(updateSTAB, 50);
                }
            }
        });

        // Initialize on load
        window.addEventListener('load', function() {
            initTypeMatrix();
        });
    </script>
</body>
</html>
