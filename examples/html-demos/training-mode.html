<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokemon Battle Assistant - Training Mode</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f1c3f 0%, #1a0933 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            color: #64b5f6;
            font-size: 2.5em;
            margin-bottom: 5px;
        }

        .header p {
            color: #b0bec5;
            font-size: 1.1em;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .tab-btn {
            padding: 12px 24px;
            background: rgba(100, 181, 246, 0.1);
            border: 2px solid #64b5f6;
            color: #64b5f6;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .tab-btn:hover {
            background: rgba(100, 181, 246, 0.2);
            transform: translateY(-2px);
        }

        .tab-btn.active {
            background: #64b5f6;
            color: #0f1c3f;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .battle-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .battle-side {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(100, 181, 246, 0.3);
            border-radius: 10px;
            padding: 20px;
        }

        .battle-side h2 {
            color: #64b5f6;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .pokemon-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }

        .pokemon-sprite {
            width: 120px;
            height: 120px;
            background: rgba(100, 181, 246, 0.1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
            border: 2px solid #64b5f6;
            overflow: hidden;
        }

        .pokemon-sprite img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .pokemon-info {
            text-align: center;
            width: 100%;
        }

        .pokemon-info h3 {
            color: #fff;
            margin-bottom: 5px;
        }

        .pokemon-types {
            display: flex;
            gap: 5px;
            justify-content: center;
            margin-bottom: 10px;
        }

        .type-badge {
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.85em;
            font-weight: 600;
            text-transform: capitalize;
        }

        .hp-bar {
            width: 100%;
            height: 25px;
            background: #1a1a1a;
            border-radius: 5px;
            overflow: hidden;
            margin: 10px 0;
            border: 1px solid #64b5f6;
        }

        .hp-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85em;
            font-weight: 600;
        }

        .hp-fill.critical {
            background: linear-gradient(90deg, #f44336, #ff5722);
        }

        .stats-display {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
            font-size: 0.95em;
        }

        .stat {
            background: rgba(100, 181, 246, 0.1);
            padding: 10px;
            border-radius: 5px;
            border-left: 3px solid #64b5f6;
        }

        .stat-label {
            color: #b0bec5;
            font-size: 0.85em;
        }

        .stat-value {
            color: #64b5f6;
            font-weight: 600;
            font-size: 1.2em;
        }

        .energy-display {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
        }

        .energy-bar {
            flex: 1;
            height: 30px;
            background: #1a1a1a;
            border-radius: 5px;
            overflow: hidden;
            border: 1px solid #ffc107;
        }

        .energy-fill {
            height: 100%;
            background: linear-gradient(90deg, #ffc107, #ffb300);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: #000;
            font-size: 0.9em;
        }

        .move-selector {
            background: rgba(100, 181, 246, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .move-selector label {
            display: block;
            margin-bottom: 10px;
            color: #64b5f6;
            font-weight: 600;
        }

        .move-options {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
        }

        .move-option {
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(100, 181, 246, 0.3);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .move-option:hover {
            background: rgba(100, 181, 246, 0.2);
            border-color: #64b5f6;
        }

        .move-option input[type="radio"] {
            margin-right: 10px;
        }

        .move-option.selected {
            background: rgba(100, 181, 246, 0.3);
            border-color: #64b5f6;
        }

        .move-name {
            font-weight: 600;
            color: #fff;
            display: inline-block;
            margin-right: 10px;
        }

        .move-stats {
            font-size: 0.85em;
            color: #b0bec5;
        }

        .buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 20px 0;
        }

        button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #64b5f6;
            color: #0f1c3f;
        }

        .btn-primary:hover {
            background: #42a5f5;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(100, 181, 246, 0.4);
        }

        .btn-primary:disabled {
            background: #666;
            color: #999;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: rgba(100, 181, 246, 0.1);
            color: #64b5f6;
            border: 1px solid #64b5f6;
        }

        .btn-secondary:hover {
            background: rgba(100, 181, 246, 0.2);
        }

        .battle-log {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(100, 181, 246, 0.2);
            border-radius: 8px;
            padding: 15px;
            height: 300px;
            overflow-y: auto;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.95em;
        }

        .log-entry {
            padding: 8px 0;
            border-bottom: 1px solid rgba(100, 181, 246, 0.1);
            color: #e0e0e0;
        }

        .log-entry.player {
            color: #64b5f6;
        }

        .log-entry.ai {
            color: #ff7043;
        }

        .log-entry.system {
            color: #81c784;
            font-style: italic;
        }

        .difficulty-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .difficulty-btn {
            padding: 15px 20px;
            background: rgba(100, 181, 246, 0.1);
            border: 2px solid rgba(100, 181, 246, 0.3);
            color: #64b5f6;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            font-size: 0.95em;
        }

        .difficulty-btn:hover {
            background: rgba(100, 181, 246, 0.2);
            border-color: #64b5f6;
        }

        .difficulty-btn.selected {
            background: #64b5f6;
            color: #0f1c3f;
            border-color: #64b5f6;
        }

        .difficulty-btn.easy { --color: #4caf50; }
        .difficulty-btn.medium { --color: #ffc107; }
        .difficulty-btn.hard { --color: #f44336; }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .metric-card {
            background: rgba(100, 181, 246, 0.1);
            border: 1px solid rgba(100, 181, 246, 0.3);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }

        .metric-label {
            color: #b0bec5;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .metric-value {
            color: #64b5f6;
            font-size: 2em;
            font-weight: 600;
        }

        .progress-bar {
            width: 100%;
            height: 40px;
            background: rgba(100, 181, 246, 0.1);
            border-radius: 5px;
            overflow: hidden;
            border: 1px solid #64b5f6;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #64b5f6, #42a5f5);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: #0f1c3f;
        }

        .scenario-card {
            background: rgba(100, 181, 246, 0.1);
            border: 1px solid rgba(100, 181, 246, 0.3);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .scenario-card:hover {
            background: rgba(100, 181, 246, 0.2);
            border-color: #64b5f6;
            transform: translateX(5px);
        }

        .scenario-card h3 {
            color: #64b5f6;
            margin-bottom: 10px;
        }

        .scenario-card p {
            color: #b0bec5;
            margin-bottom: 10px;
        }

        .scenario-stats {
            display: flex;
            gap: 15px;
            font-size: 0.9em;
        }

        .scenario-stat {
            color: #81c784;
        }

        .hint-box {
            background: rgba(129, 199, 132, 0.1);
            border-left: 4px solid #81c784;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            color: #c8e6c9;
        }

        .hint-box strong {
            color: #81c784;
        }

        .tips-container {
            background: rgba(255, 193, 7, 0.1);
            border-left: 4px solid #ffc107;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }

        .tips-container h4 {
            color: #ffc107;
            margin-bottom: 10px;
        }

        .tips-list {
            list-style: none;
            padding: 0;
        }

        .tips-list li {
            padding: 8px 0;
            color: #ffe082;
            border-bottom: 1px solid rgba(255, 193, 7, 0.2);
        }

        .tips-list li:last-child {
            border-bottom: none;
        }

        .trophy {
            font-size: 3em;
            text-align: center;
            margin: 20px 0;
        }

        .badge {
            display: inline-block;
            background: linear-gradient(135deg, #ffc107, #ff9800);
            color: #0f1c3f;
            padding: 10px 15px;
            border-radius: 20px;
            font-weight: 600;
            margin: 5px;
            text-transform: uppercase;
            font-size: 0.85em;
        }

        .badge.gold {
            background: linear-gradient(135deg, #ffc107, #ffb300);
        }

        .badge.silver {
            background: linear-gradient(135deg, #bdbdbd, #a1a1a1);
            color: #0f1c3f;
        }

        .badge.bronze {
            background: linear-gradient(135deg, #d7a547, #c57a2a);
            color: #0f1c3f;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #64b5f6;
        }

        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(100, 181, 246, 0.3);
            border-top: 4px solid #64b5f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-box {
            background: rgba(244, 67, 54, 0.1);
            border: 1px solid #f44336;
            color: #ef5350;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .success-box {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid #4caf50;
            color: #81c784;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .mobile-stack {
            grid-template-columns: 1fr;
        }

        @media (max-width: 768px) {
            .battle-container {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .tabs {
                flex-direction: column;
            }

            .tab-btn {
                width: 100%;
            }

            .pokemon-sprite {
                width: 100px;
                height: 100px;
            }

            .difficulty-selector {
                grid-template-columns: 1fr;
            }

            .metrics-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Type colors */
        .type-normal { background: #a8a878; }
        .type-fire { background: #f08030; }
        .type-water { background: #6890f0; }
        .type-grass { background: #78c850; }
        .type-electric { background: #f8d030; color: #333; }
        .type-ice { background: #98d8d8; color: #333; }
        .type-fighting { background: #c03028; }
        .type-poison { background: #a040a0; }
        .type-ground { background: #e0c068; color: #333; }
        .type-flying { background: #a890f0; }
        .type-psychic { background: #f85888; }
        .type-bug { background: #a8b820; }
        .type-rock { background: #b8a038; }
        .type-ghost { background: #705898; }
        .type-dragon { background: #7038f8; }
        .type-dark { background: #705848; }
        .type-steel { background: #b8b8d0; color: #333; }
        .type-fairy { background: #ee99ac; color: #333; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Pokemon Battle Training Mode</h1>
            <p>Master PvP mechanics through structured practice scenarios</p>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('practice-battles')">Practice Battles</button>
            <button class="tab-btn" onclick="switchTab('energy-training')">Energy Management</button>
            <button class="tab-btn" onclick="switchTab('shield-baiting')">Shield Baiting</button>
            <button class="tab-btn" onclick="switchTab('move-counting')">Move Counting</button>
            <button class="tab-btn" onclick="switchTab('type-coverage')">Type Coverage</button>
            <button class="tab-btn" onclick="switchTab('battle-metrics')">Battle Metrics</button>
            <button class="tab-btn" onclick="switchTab('tips-hints')">Tips & Hints</button>
            <button class="tab-btn" onclick="switchTab('progress')">Progress</button>
        </div>

        <!-- PRACTICE BATTLES TAB -->
        <div id="practice-battles" class="tab-content active">
            <div style="text-align: center; margin-bottom: 30px;">
                <h2 style="color: #64b5f6; margin-bottom: 20px;">Select Difficulty Level</h2>
                <div class="difficulty-selector">
                    <button class="difficulty-btn easy selected" onclick="setDifficulty('easy')">Easy</button>
                    <button class="difficulty-btn medium" onclick="setDifficulty('medium')">Medium</button>
                    <button class="difficulty-btn hard" onclick="setDifficulty('hard')">Hard</button>
                </div>
            </div>

            <div id="battle-setup" class="battle-container">
                <!-- PLAYER SIDE -->
                <div class="battle-side">
                    <h2>Your Pokemon</h2>
                    <div class="pokemon-display" id="player-pokemon-display">
                        <div class="pokemon-sprite">
                            <span style="color: #64b5f6;">Select Pokemon</span>
                        </div>
                        <div class="pokemon-info">
                            <p style="color: #999;">None selected</p>
                        </div>
                    </div>

                    <div class="move-selector">
                        <label>Fast Move:</label>
                        <select id="player-fast-move" style="width: 100%; padding: 8px; background: #1a1a1a; color: #64b5f6; border: 1px solid #64b5f6; border-radius: 5px;">
                            <option>Select fast move...</option>
                        </select>
                    </div>

                    <div class="move-selector">
                        <label>Charged Move 1:</label>
                        <select id="player-charged-move-1" style="width: 100%; padding: 8px; background: #1a1a1a; color: #64b5f6; border: 1px solid #64b5f6; border-radius: 5px;">
                            <option>Select charged move...</option>
                        </select>
                    </div>

                    <div class="move-selector">
                        <label>Charged Move 2:</label>
                        <select id="player-charged-move-2" style="width: 100%; padding: 8px; background: #1a1a1a; color: #64b5f6; border: 1px solid #64b5f6; border-radius: 5px;">
                            <option>Select charged move...</option>
                        </select>
                    </div>

                    <input type="text" id="player-search" placeholder="Search your Pokemon..." style="width: 100%; padding: 10px; margin: 15px 0; background: #1a1a1a; color: #64b5f6; border: 1px solid #64b5f6; border-radius: 5px;">
                    <div id="player-pokemon-list" style="max-height: 300px; overflow-y: auto;"></div>
                </div>

                <!-- OPPONENT SIDE -->
                <div class="battle-side">
                    <h2>Opponent Pokemon</h2>
                    <div class="pokemon-display" id="opponent-pokemon-display">
                        <div class="pokemon-sprite">
                            <span style="color: #ff7043;">None selected</span>
                        </div>
                        <div class="pokemon-info">
                            <p style="color: #999;">None selected</p>
                        </div>
                    </div>

                    <div class="move-selector">
                        <label>Fast Move:</label>
                        <select id="opponent-fast-move" style="width: 100%; padding: 8px; background: #1a1a1a; color: #ff7043; border: 1px solid #ff7043; border-radius: 5px;" disabled>
                            <option>AI will select...</option>
                        </select>
                    </div>

                    <div class="move-selector">
                        <label>Charged Move 1:</label>
                        <select id="opponent-charged-move-1" style="width: 100%; padding: 8px; background: #1a1a1a; color: #ff7043; border: 1px solid #ff7043; border-radius: 5px;" disabled>
                            <option>AI will select...</option>
                        </select>
                    </div>

                    <div class="move-selector">
                        <label>Charged Move 2:</label>
                        <select id="opponent-charged-move-2" style="width: 100%; padding: 8px; background: #1a1a1a; color: #ff7043; border: 1px solid #ff7043; border-radius: 5px;" disabled>
                            <option>AI will select...</option>
                        </select>
                    </div>

                    <input type="text" id="opponent-search" placeholder="Search opponent Pokemon..." style="width: 100%; padding: 10px; margin: 15px 0; background: #1a1a1a; color: #ff7043; border: 1px solid #ff7043; border-radius: 5px;">
                    <div id="opponent-pokemon-list" style="max-height: 300px; overflow-y: auto;"></div>
                </div>
            </div>

            <div class="buttons">
                <button class="btn-primary" onclick="startBattle()">Start Battle</button>
                <button class="btn-secondary" onclick="resetBattle()">Reset</button>
            </div>

            <div id="battle-arena" style="display: none;">
                <div class="battle-container">
                    <div class="battle-side">
                        <h2>You</h2>
                        <div class="pokemon-display" id="battle-player-display"></div>
                        <div class="hp-bar">
                            <div class="hp-fill" id="player-hp-fill" style="width: 100%;">
                                <span id="player-hp-text">100/100</span>
                            </div>
                        </div>
                        <div class="energy-display">
                            <span>Energy:</span>
                            <div class="energy-bar">
                                <div class="energy-fill" id="player-energy-fill" style="width: 0%;">
                                    <span id="player-energy-text">0/100</span>
                                </div>
                            </div>
                        </div>
                        <div style="margin: 15px 0;">
                            <label style="color: #64b5f6; margin-bottom: 10px; display: block;">Your Move:</label>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <button class="btn-primary" id="player-fast-btn" onclick="playerFastMove()">Fast Move</button>
                                <button class="btn-primary" id="player-charged-btn" onclick="playerChargedMove()">Charged Move</button>
                            </div>
                        </div>
                        <div style="margin: 15px 0;">
                            <label style="color: #64b5f6; margin-bottom: 10px; display: block;">Shields:</label>
                            <button class="btn-secondary" id="player-shield-btn" onclick="useShield()">Use Shield (2)</button>
                        </div>
                    </div>

                    <div class="battle-side">
                        <h2>Opponent</h2>
                        <div class="pokemon-display" id="battle-opponent-display"></div>
                        <div class="hp-bar">
                            <div class="hp-fill" id="opponent-hp-fill" style="width: 100%; background: linear-gradient(90deg, #ff7043, #ff6e40);">
                                <span id="opponent-hp-text" style="color: #fff;">100/100</span>
                            </div>
                        </div>
                        <div class="energy-display">
                            <span>Energy:</span>
                            <div class="energy-bar">
                                <div class="energy-fill" id="opponent-energy-fill" style="width: 0%; background: linear-gradient(90deg, #ff9800, #ff8a00);">
                                    <span id="opponent-energy-text" style="color: #000;">0/100</span>
                                </div>
                            </div>
                        </div>
                        <div style="margin: 15px 0;">
                            <div style="color: #b0bec5;">
                                <p id="opponent-action" style="text-align: center; padding: 10px; background: rgba(255, 112, 67, 0.1); border-radius: 5px; margin: 10px 0;">Waiting...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="battle-log" id="battle-log"></div>

                <div class="buttons">
                    <button class="btn-primary" onclick="endBattle()">End Battle</button>
                    <button class="btn-secondary" onclick="toggleBattleLog()">Toggle Log</button>
                </div>
            </div>
        </div>

        <!-- ENERGY MANAGEMENT TAB -->
        <div id="energy-training" class="tab-content">
            <h2 style="color: #64b5f6; margin-bottom: 20px;">Energy Management Training</h2>
            <p style="color: #b0bec5; margin-bottom: 20px;">Learn to optimize energy usage and timing for charged moves.</p>

            <div class="scenario-card">
                <h3>Scenario 1: Energy Race</h3>
                <p>Both Pokemon use the same fast move. First to 100 energy wins! Learn energy gain rates.</p>
                <div class="scenario-stats">
                    <span class="scenario-stat">⏱ 3 min</span>
                    <span class="scenario-stat">📊 Beginner</span>
                </div>
                <button class="btn-primary" onclick="startEnergyScenario(1)" style="margin-top: 15px;">Start Scenario</button>
            </div>

            <div class="scenario-card">
                <h3>Scenario 2: Efficient Charging</h3>
                <p>Maximize energy gain with fast moves. Understand which moves charge fastest.</p>
                <div class="scenario-stats">
                    <span class="scenario-stat">⏱ 5 min</span>
                    <span class="scenario-stat">📊 Intermediate</span>
                </div>
                <button class="btn-primary" onclick="startEnergyScenario(2)" style="margin-top: 15px;">Start Scenario</button>
            </div>

            <div class="scenario-card">
                <h3>Scenario 3: Energy Denial</h3>
                <p>Switch out to deny opponent's charged move. Master switch mechanics and timing.</p>
                <div class="scenario-stats">
                    <span class="scenario-stat">⏱ 7 min</span>
                    <span class="scenario-stat">📊 Advanced</span>
                </div>
                <button class="btn-primary" onclick="startEnergyScenario(3)" style="margin-top: 15px;">Start Scenario</button>
            </div>

            <div class="hint-box">
                <strong>💡 Energy Tip:</strong> Energy gain comes from using fast moves. Most fast moves gain 4-8 energy per use. Plan ahead to ensure you reach charged move thresholds at optimal times.
            </div>
        </div>

        <!-- SHIELD BAITING TAB -->
        <div id="shield-baiting" class="tab-content">
            <h2 style="color: #64b5f6; margin-bottom: 20px;">Shield Baiting Practice</h2>
            <p style="color: #b0bec5; margin-bottom: 20px;">Learn to bait shields effectively and force out enemy defenses.</p>

            <div class="scenario-card">
                <h3>Bait Recognition</h3>
                <p>Opponent has 2 shields. Which move should you throw to bait? Identify obvious bait patterns.</p>
                <div class="scenario-stats">
                    <span class="scenario-stat">⏱ 2 min</span>
                    <span class="scenario-stat">📊 Beginner</span>
                </div>
                <button class="btn-primary" onclick="startShieldScenario(1)" style="margin-top: 15px;">Start Scenario</button>
            </div>

            <div class="scenario-card">
                <h3>Sequence Baiting</h3>
                <p>Throw 2-3 weak moves to exhaust opponent shields, then hit with powerful move.</p>
                <div class="scenario-stats">
                    <span class="scenario-stat">⏱ 5 min</span>
                    <span class="scenario-stat">📊 Intermediate</span>
                </div>
                <button class="btn-primary" onclick="startShieldScenario(2)" style="margin-top: 15px;">Start Scenario</button>
            </div>

            <div class="scenario-card">
                <h3>Safe Baits</h3>
                <p>Throw charged moves that won't lose you the game even if not shielded. Master risk/reward.</p>
                <div class="scenario-stats">
                    <span class="scenario-stat">⏱ 7 min</span>
                    <span class="scenario-stat">📊 Advanced</span>
                </div>
                <button class="btn-primary" onclick="startShieldScenario(3)" style="margin-top: 15px;">Start Scenario</button>
            </div>

            <div class="hint-box">
                <strong>💡 Baiting Tip:</strong> Force shields when opponent has limited shields remaining. Weak charged moves or move resists make good baits. Save your strongest moves for after shields are gone.
            </div>
        </div>

        <!-- MOVE COUNTING TAB -->
        <div id="move-counting" class="tab-content">
            <h2 style="color: #64b5f6; margin-bottom: 20px;">Fast Move Counting Trainer</h2>
            <p style="color: #b0bec5; margin-bottom: 20px;">Master the art of counting fast move turns to predict opponent's charged moves.</p>

            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-label">Fast Moves Tracked</div>
                    <div class="metric-value" id="moves-counted">0</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Accuracy</div>
                    <div class="metric-value" id="counting-accuracy">0%</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Session Score</div>
                    <div class="metric-value" id="counting-score">0</div>
                </div>
            </div>

            <div class="battle-container">
                <div class="battle-side">
                    <h2>Opponent Pokemon</h2>
                    <div class="pokemon-display" id="counting-opponent-display"></div>
                    <div style="margin: 20px 0;">
                        <label style="color: #64b5f6; margin-bottom: 10px; display: block;">Fast Move:</label>
                        <p id="counting-fast-move" style="color: #fff; font-weight: 600; font-size: 1.2em;">-</p>
                    </div>
                    <div style="margin: 20px 0;">
                        <label style="color: #64b5f6; margin-bottom: 10px; display: block;">Fast Moves Detected:</label>
                        <p id="move-count-display" style="color: #ffc107; font-weight: 600; font-size: 1.5em;">0</p>
                    </div>
                    <div style="margin: 20px 0;">
                        <label style="color: #64b5f6; margin-bottom: 10px; display: block;">Fast Move Turns Each:</label>
                        <p id="move-turn-info" style="color: #b0bec5;">-</p>
                    </div>
                </div>

                <div class="battle-side">
                    <h2>Your Prediction</h2>
                    <div style="margin: 20px 0;">
                        <label style="color: #64b5f6; margin-bottom: 10px; display: block;">How many fast moves until charged?</label>
                        <input type="number" id="move-count-input" min="1" max="50" style="width: 100%; padding: 10px; background: #1a1a1a; color: #64b5f6; border: 1px solid #64b5f6; border-radius: 5px; font-size: 1.2em;">
                    </div>
                    <div style="margin: 20px 0;">
                        <label style="color: #64b5f6; margin-bottom: 10px; display: block;">Predicted Charged Move:</label>
                        <select id="move-prediction" style="width: 100%; padding: 10px; background: #1a1a1a; color: #64b5f6; border: 1px solid #64b5f6; border-radius: 5px;">
                            <option>Select predicted move...</option>
                        </select>
                    </div>
                    <div class="buttons" style="margin-top: 30px;">
                        <button class="btn-primary" onclick="startMoveCounting()">Start Training</button>
                        <button class="btn-secondary" onclick="submitMovePrediction()">Submit Prediction</button>
                    </div>
                </div>
            </div>

            <div class="hint-box" style="margin-top: 20px;">
                <strong>💡 Counting Tip:</strong> Each fast move has a "turns" value (1-2 turns). Count opponent's fast moves in cycles. When you reach the charged move threshold (usually 4-6 energy gained), the opponent can throw!
            </div>
        </div>

        <!-- TYPE COVERAGE TAB -->
        <div id="type-coverage" class="tab-content">
            <h2 style="color: #64b5f6; margin-bottom: 20px;">Type Coverage Challenge</h2>
            <p style="color: #b0bec5; margin-bottom: 20px;">Master type advantages and coverage to counter any opponent Pokemon.</p>

            <div class="scenario-card">
                <h3>Challenge 1: Type Advantage Quiz</h3>
                <p>Given an opponent Pokemon, what type move covers it best? Learn type effectiveness matrix.</p>
                <div class="scenario-stats">
                    <span class="scenario-stat">⏱ 5 min</span>
                    <span class="scenario-stat">📊 Beginner</span>
                    <span class="scenario-stat">❓ 10 Questions</span>
                </div>
                <button class="btn-primary" onclick="startCoverageChallenge(1)" style="margin-top: 15px;">Start Challenge</button>
            </div>

            <div class="scenario-card">
                <h3>Challenge 2: Dual Type Weakness</h3>
                <p>Identify weaknesses for dual-type Pokemon. Account for both types in coverage.</p>
                <div class="scenario-stats">
                    <span class="scenario-stat">⏱ 8 min</span>
                    <span class="scenario-stat">📊 Intermediate</span>
                    <span class="scenario-stat">❓ 15 Questions</span>
                </div>
                <button class="btn-primary" onclick="startCoverageChallenge(2)" style="margin-top: 15px;">Start Challenge</button>
            </div>

            <div class="scenario-card">
                <h3>Challenge 3: Team Coverage</h3>
                <p>Build a team that covers the meta. Identify coverage gaps and overlaps.</p>
                <div class="scenario-stats">
                    <span class="scenario-stat">⏱ 10 min</span>
                    <span class="scenario-stat">📊 Advanced</span>
                    <span class="scenario-stat">❓ 20 Questions</span>
                </div>
                <button class="btn-primary" onclick="startCoverageChallenge(3)" style="margin-top: 15px;">Start Challenge</button>
            </div>

            <div class="hint-box">
                <strong>💡 Coverage Tip:</strong> Every Pokemon should have type coverage. If your Pokemon resists opponent's moves but has no super-effective coverage, you'll struggle. Balance defense and offense!
            </div>
        </div>

        <!-- BATTLE METRICS TAB -->
        <div id="battle-metrics" class="tab-content">
            <h2 style="color: #64b5f6; margin-bottom: 20px;">Battle Metrics & Analysis</h2>
            <p style="color: #b0bec5; margin-bottom: 20px;">Track your performance across all training scenarios.</p>

            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-label">Total Battles</div>
                    <div class="metric-value" id="total-battles">0</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Win Rate</div>
                    <div class="metric-value" id="win-rate">0%</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Avg Duration</div>
                    <div class="metric-value" id="avg-duration">0s</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Shield Usage</div>
                    <div class="metric-value" id="shield-accuracy">0%</div>
                </div>
            </div>

            <div style="background: rgba(100, 181, 246, 0.1); border: 1px solid rgba(100, 181, 246, 0.3); border-radius: 8px; padding: 20px; margin: 20px 0;">
                <h3 style="color: #64b5f6; margin-bottom: 15px;">Recent Battles</h3>
                <div id="recent-battles-list" style="max-height: 400px; overflow-y: auto;">
                    <p style="color: #999; text-align: center;">No battles recorded yet. Start training!</p>
                </div>
            </div>

            <div style="background: rgba(100, 181, 246, 0.1); border: 1px solid rgba(100, 181, 246, 0.3); border-radius: 8px; padding: 20px; margin: 20px 0;">
                <h3 style="color: #64b5f6; margin-bottom: 15px;">Detailed Metrics</h3>
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-label">Accuracy (Move Timing)</div>
                        <div class="metric-value" id="accuracy-metric">0%</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Efficiency (Energy Use)</div>
                        <div class="metric-value" id="efficiency-metric">0%</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Strategy Score</div>
                        <div class="metric-value" id="strategy-metric">0</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TIPS & HINTS TAB -->
        <div id="tips-hints" class="tab-content">
            <h2 style="color: #64b5f6; margin-bottom: 20px;">Tips, Tricks & Hints</h2>
            <p style="color: #b0bec5; margin-bottom: 20px;">Master the fundamentals of PvP gameplay.</p>

            <div class="tips-container">
                <h4>Energy Management</h4>
                <ul class="tips-list">
                    <li>⚡ Fast moves generate energy each turn. Plan when you'll have enough for charged moves.</li>
                    <li>⚡ Different fast moves gain different energy rates. Vine Whip gains 4, Water Gun gains 5.</li>
                    <li>⚡ Switch out to "bank" energy on the next Pokemon. Energy carries over to switched Pokemon.</li>
                    <li>⚡ Deny opponent energy by switching when they're close to a charged move.</li>
                </ul>
            </div>

            <div class="tips-container">
                <h4>Shield Usage</h4>
                <ul class="tips-list">
                    <li>🛡️ You have 2 shields per battle (in most formats). Use them strategically!</li>
                    <li>🛡️ Save shields for moves that would KO you or flip the matchup.</li>
                    <li>🛡️ Bait shields with weak moves when opponent has full shields remaining.</li>
                    <li>🛡️ Once shields are gone, play more cautiously. Any charged move can threaten a KO.</li>
                </ul>
            </div>

            <div class="tips-container">
                <h4>Move Selection</h4>
                <ul class="tips-list">
                    <li>🎯 Pick charged moves with different coverage. Don't redundant super-effective coverage.</li>
                    <li>🎯 Balance fast move for damage output vs. charged move buildup speed.</li>
                    <li>🎯 Consider move animation duration when predicting opponent timing.</li>
                    <li>🎯 Legacy moves can have unique coverage. Check what's available for your Pokemon.</li>
                </ul>
            </div>

            <div class="tips-container">
                <h4>Type Coverage</h4>
                <ul class="tips-list">
                    <li>📊 Every Pokemon has strengths and weaknesses. Build teams with synergy.</li>
                    <li>📊 Dual-type Pokemon have more complex matchups. Account for both types!</li>
                    <li>📊 Super-effective coverage beats defensive stats. Good coverage wins games.</li>
                    <li>📊 Some types are "always good" (water, grass). Others are situational.</li>
                </ul>
            </div>

            <div class="tips-container">
                <h4>Advanced Tactics</h4>
                <ul class="tips-list">
                    <li>🎮 CMP (Attack stat tiebreaker) decides who goes first when both charge. Higher attack wins!</li>
                    <li>🎮 Swap-in mechanics: Switching costs 2 turns. Plan swaps carefully!</li>
                    <li>🎮 Baiting: Force shields by throwing weak moves. Then KO with powered-up move.</li>
                    <li>🎮 Wall/Pivot Pokemon: Use them to safely check threats and farm down opponents.</li>
                </ul>
            </div>
        </div>

        <!-- PROGRESS TAB -->
        <div id="progress" class="tab-content">
            <h2 style="color: #64b5f6; margin-bottom: 20px;">Your Training Progress</h2>
            <p style="color: #b0bec5; margin-bottom: 20px;">Track your mastery of PvP mechanics.</p>

            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-label">Battles Completed</div>
                    <div class="metric-value" id="progress-battles">0</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Scenarios Completed</div>
                    <div class="metric-value" id="progress-scenarios">0</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Overall Skill Level</div>
                    <div class="metric-value" id="progress-level">Beginner</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Playtime</div>
                    <div class="metric-value" id="progress-playtime">0m</div>
                </div>
            </div>

            <div style="background: rgba(100, 181, 246, 0.1); border: 1px solid rgba(100, 181, 246, 0.3); border-radius: 8px; padding: 20px; margin: 20px 0;">
                <h3 style="color: #64b5f6; margin-bottom: 15px;">Skill Progression</h3>
                <div style="margin: 20px 0;">
                    <h4 style="color: #b0bec5; margin-bottom: 10px;">Energy Management</h4>
                    <div class="progress-bar">
                        <div class="progress-fill" id="skill-energy" style="width: 0%;">0%</div>
                    </div>
                </div>
                <div style="margin: 20px 0;">
                    <h4 style="color: #b0bec5; margin-bottom: 10px;">Shield Usage</h4>
                    <div class="progress-bar">
                        <div class="progress-fill" id="skill-shields" style="width: 0%;">0%</div>
                    </div>
                </div>
                <div style="margin: 20px 0;">
                    <h4 style="color: #b0bec5; margin-bottom: 10px;">Move Timing</h4>
                    <div class="progress-bar">
                        <div class="progress-fill" id="skill-timing" style="width: 0%;">0%</div>
                    </div>
                </div>
                <div style="margin: 20px 0;">
                    <h4 style="color: #b0bec5; margin-bottom: 10px;">Type Coverage</h4>
                    <div class="progress-bar">
                        <div class="progress-fill" id="skill-coverage" style="width: 0%;">0%</div>
                    </div>
                </div>
            </div>

            <div style="background: rgba(76, 175, 80, 0.1); border: 1px solid rgba(76, 175, 80, 0.3); border-radius: 8px; padding: 20px; margin: 20px 0;">
                <h3 style="color: #81c784; margin-bottom: 15px;">Achievements</h3>
                <div id="achievements-list" style="display: flex; flex-wrap: wrap; gap: 10px;">
                    <p style="color: #999; width: 100%;">Complete challenges to unlock achievements!</p>
                </div>
            </div>

            <div class="buttons">
                <button class="btn-primary" onclick="exportProgress()">Export Progress</button>
                <button class="btn-secondary" onclick="clearProgress()">Reset All Data</button>
            </div>
        </div>
    </div>

    <script>
        // ===== GLOBAL STATE =====
        let gameData = {
            pokemon: [],
            moves: [],
            typeChart: {}
        };

        let battleState = {
            playerPokemon: null,
            playerHP: 100,
            playerMaxHP: 100,
            playerEnergy: 0,
            playerShields: 2,
            playerFastMove: null,
            playerChargedMove1: null,
            playerChargedMove2: null,

            opponentPokemon: null,
            opponentHP: 100,
            opponentMaxHP: 100,
            opponentEnergy: 0,
            opponentShields: 2,
            opponentFastMove: null,
            opponentChargedMove1: null,
            opponentChargedMove2: null,

            difficulty: 'easy',
            battleLog: [],
            battleActive: false,
            turnCount: 0,
            startTime: null
        };

        let progressData = {
            totalBattles: 0,
            battleWins: 0,
            battlesCompleted: [],
            scenariosCompleted: [],
            skillLevels: {
                energy: 0,
                shields: 0,
                timing: 0,
                coverage: 0
            },
            achievements: [],
            playtime: 0
        };

        // ===== INITIALIZATION =====
        async function initApp() {
            try {
                console.log('Loading gamemaster.json...');
                const response = await fetch('https://raw.githubusercontent.com/pvpoke/pvpoke/master/src/data/gamemaster.json');
                const data = await response.json();

                gameData.pokemon = data.pokemon || [];
                gameData.moves = data.moves || [];
                gameData.typeChart = buildTypeChart();

                console.log(`Loaded ${gameData.pokemon.length} Pokemon and ${gameData.moves.length} moves`);

                loadProgress();
                updateUI();
                populatePokemonLists();
            } catch (error) {
                console.error('Error loading data:', error);
                showError('Failed to load game data. Please refresh the page.');
            }
        }

        // ===== TAB MANAGEMENT =====
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // ===== POKEMON SELECTION =====
        function populatePokemonLists() {
            const playerList = document.getElementById('player-pokemon-list');
            const opponentList = document.getElementById('opponent-pokemon-list');

            const pokemonHTML = gameData.pokemon
                .slice(0, 100) // Limit to first 100 for performance
                .map(p => `
                    <div style="padding: 10px; background: rgba(100, 181, 246, 0.05); border-radius: 5px; margin: 5px 0; cursor: pointer;" onclick="selectPlayerPokemon('${p.speciesId}')">
                        <strong>${p.speciesName}</strong> - ${p.types.join('/')}
                    </div>
                `)
                .join('');

            playerList.innerHTML = pokemonHTML;

            opponentList.innerHTML = gameData.pokemon
                .slice(0, 100)
                .map(p => `
                    <div style="padding: 10px; background: rgba(255, 112, 67, 0.05); border-radius: 5px; margin: 5px 0; cursor: pointer;" onclick="selectOpponentPokemon('${p.speciesId}')">
                        <strong>${p.speciesName}</strong> - ${p.types.join('/')}
                    </div>
                `)
                .join('');
        }

        function selectPlayerPokemon(speciesId) {
            const pokemon = gameData.pokemon.find(p => p.speciesId === speciesId);
            if (!pokemon) return;

            battleState.playerPokemon = pokemon;
            battleState.playerHP = 100;
            battleState.playerMaxHP = 100;
            battleState.playerEnergy = 0;
            battleState.playerShields = 2;

            updatePlayerPokemonDisplay();
            populatePlayerMoves();
        }

        function selectOpponentPokemon(speciesId) {
            const pokemon = gameData.pokemon.find(p => p.speciesId === speciesId);
            if (!pokemon) return;

            battleState.opponentPokemon = pokemon;
            battleState.opponentHP = 100;
            battleState.opponentMaxHP = 100;
            battleState.opponentEnergy = 0;
            battleState.opponentShields = 2;

            updateOpponentPokemonDisplay();
            populateOpponentMoves();
        }

        function updatePlayerPokemonDisplay() {
            const poke = battleState.playerPokemon;
            if (!poke) return;

            const display = document.getElementById('player-pokemon-display');
            display.innerHTML = `
                <div class="pokemon-sprite">
                    <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${poke.dex}.png" onerror="this.style.display='none'">
                </div>
                <div class="pokemon-info">
                    <h3>${poke.speciesName}</h3>
                    <div class="pokemon-types">
                        ${poke.types.map(t => `<span class="type-badge type-${t}">${t}</span>`).join('')}
                    </div>
                </div>
            `;
        }

        function updateOpponentPokemonDisplay() {
            const poke = battleState.opponentPokemon;
            if (!poke) return;

            const display = document.getElementById('opponent-pokemon-display');
            display.innerHTML = `
                <div class="pokemon-sprite" style="border-color: #ff7043;">
                    <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${poke.dex}.png" onerror="this.style.display='none'">
                </div>
                <div class="pokemon-info">
                    <h3>${poke.speciesName}</h3>
                    <div class="pokemon-types">
                        ${poke.types.map(t => `<span class="type-badge type-${t}">${t}</span>`).join('')}
                    </div>
                </div>
            `;
        }

        function populatePlayerMoves() {
            const poke = battleState.playerPokemon;
            if (!poke) return;

            // Fast moves
            const fastSelect = document.getElementById('player-fast-move');
            fastSelect.innerHTML = '<option>Select fast move...</option>' + poke.fastMoves.map(moveId => {
                const move = gameData.moves.find(m => m.moveId === moveId);
                return `<option value="${moveId}">${move ? move.name : moveId}</option>`;
            }).join('');

            // Charged moves
            const charged1 = document.getElementById('player-charged-move-1');
            charged1.innerHTML = '<option>Select charged move...</option>' + poke.chargedMoves.map(moveId => {
                const move = gameData.moves.find(m => m.moveId === moveId);
                return `<option value="${moveId}">${move ? move.name : moveId}</option>`;
            }).join('');

            const charged2 = document.getElementById('player-charged-move-2');
            charged2.innerHTML = '<option>Select charged move...</option>' + poke.chargedMoves.map(moveId => {
                const move = gameData.moves.find(m => m.moveId === moveId);
                return `<option value="${moveId}">${move ? move.name : moveId}</option>`;
            }).join('');

            fastSelect.addEventListener('change', (e) => {
                battleState.playerFastMove = gameData.moves.find(m => m.moveId === e.target.value);
            });

            charged1.addEventListener('change', (e) => {
                battleState.playerChargedMove1 = gameData.moves.find(m => m.moveId === e.target.value);
            });

            charged2.addEventListener('change', (e) => {
                battleState.playerChargedMove2 = gameData.moves.find(m => m.moveId === e.target.value);
            });
        }

        function populateOpponentMoves() {
            const poke = battleState.opponentPokemon;
            if (!poke) return;

            // AI selects optimal moves
            const fastMove = poke.fastMoves[Math.floor(Math.random() * poke.fastMoves.length)];
            const chargedMoves = poke.chargedMoves.slice(0, 2);

            battleState.opponentFastMove = gameData.moves.find(m => m.moveId === fastMove);
            battleState.opponentChargedMove1 = gameData.moves.find(m => m.moveId === chargedMoves[0]);
            battleState.opponentChargedMove2 = gameData.moves.find(m => m.moveId === chargedMoves[1]);

            const fastSelect = document.getElementById('opponent-fast-move');
            fastSelect.value = battleState.opponentFastMove?.name || 'AI will select...';

            const charged1 = document.getElementById('opponent-charged-move-1');
            charged1.value = battleState.opponentChargedMove1?.name || 'AI will select...';

            const charged2 = document.getElementById('opponent-charged-move-2');
            charged2.value = battleState.opponentChargedMove2?.name || 'AI will select...';
        }

        // ===== DIFFICULTY SETTING =====
        function setDifficulty(level) {
            battleState.difficulty = level;
            document.querySelectorAll('.difficulty-btn').forEach(btn => btn.classList.remove('selected'));
            event.target.classList.add('selected');
        }

        // ===== BATTLE MECHANICS =====
        function startBattle() {
            if (!battleState.playerPokemon || !battleState.opponentPokemon) {
                showError('Please select Pokemon for both sides!');
                return;
            }

            if (!battleState.playerFastMove || !battleState.playerChargedMove1) {
                showError('Please select moves for your Pokemon!');
                return;
            }

            battleState.battleActive = true;
            battleState.turnCount = 0;
            battleState.startTime = Date.now();
            battleState.battleLog = [];

            document.getElementById('battle-setup').style.display = 'none';
            document.getElementById('battle-arena').style.display = 'block';

            updateBattleDisplay();
            logBattleMessage('Battle started! Good luck!', 'system');

            // AI starts thinking after a delay
            setTimeout(() => aiTurn(), 2000);
        }

        function playerFastMove() {
            if (!battleState.battleActive || !battleState.playerFastMove) return;

            const damage = Math.random() * 10 + 5; // 5-15 damage
            battleState.opponentHP = Math.max(0, battleState.opponentHP - damage);
            battleState.playerEnergy += battleState.playerFastMove.energyGain || 4;

            logBattleMessage(`You use ${battleState.playerFastMove.name}! Opponent takes ${Math.round(damage)} damage.`, 'player');
            updateBattleDisplay();

            if (battleState.opponentHP <= 0) {
                endBattleVictory();
                return;
            }

            battleState.turnCount++;
            setTimeout(() => aiTurn(), 1500);
        }

        function playerChargedMove() {
            if (!battleState.battleActive || !battleState.playerChargedMove1) return;
            if (battleState.playerEnergy < 100) {
                showError('Not enough energy for charged move!');
                return;
            }

            const damage = Math.random() * 30 + 20; // 20-50 damage
            battleState.opponentHP = Math.max(0, battleState.opponentHP - damage);
            battleState.playerEnergy = 0;

            logBattleMessage(`You charge and use ${battleState.playerChargedMove1.name}! Big hit for ${Math.round(damage)} damage!`, 'player');
            updateBattleDisplay();

            if (battleState.opponentHP <= 0) {
                endBattleVictory();
                return;
            }

            battleState.turnCount++;
            setTimeout(() => aiTurn(), 1500);
        }

        function useShield() {
            if (!battleState.battleActive || battleState.playerShields <= 0) {
                showError('No shields remaining!');
                return;
            }

            battleState.playerShields--;
            logBattleMessage(`Shield used! ${battleState.playerShields} shields remaining.`, 'player');
            updateBattleDisplay();
        }

        function aiTurn() {
            if (!battleState.battleActive) return;

            // AI decision logic based on difficulty
            let aiAction = 'fast';
            let randomFactor = Math.random();

            if (battleState.difficulty === 'easy') {
                aiAction = randomFactor > 0.3 ? 'fast' : 'charged';
            } else if (battleState.difficulty === 'medium') {
                if (battleState.opponentEnergy >= 100) {
                    aiAction = randomFactor > 0.5 ? 'charged' : 'fast';
                }
            } else { // hard
                if (battleState.opponentEnergy >= 100) {
                    aiAction = randomFactor > 0.7 ? 'charged' : 'fast';
                }
            }

            if (aiAction === 'fast') {
                const damage = Math.random() * 8 + 3;
                battleState.playerHP = Math.max(0, battleState.playerHP - damage);
                battleState.opponentEnergy += battleState.opponentFastMove?.energyGain || 4;
                logBattleMessage(`Opponent uses ${battleState.opponentFastMove?.name || 'Fast Move'}! You take ${Math.round(damage)} damage.`, 'ai');
            } else {
                const damage = Math.random() * 25 + 15;
                battleState.playerHP = Math.max(0, battleState.playerHP - damage);
                battleState.opponentEnergy = 0;
                logBattleMessage(`Opponent charges up and uses ${battleState.opponentChargedMove1?.name || 'Charged Move'}! You take ${Math.round(damage)} damage!`, 'ai');
            }

            updateBattleDisplay();

            if (battleState.playerHP <= 0) {
                endBattleDefeat();
            }
        }

        function updateBattleDisplay() {
            // Player display
            const playerDisplay = document.getElementById('battle-player-display');
            playerDisplay.innerHTML = `
                <div class="pokemon-sprite" style="border-color: #64b5f6;">
                    <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${battleState.playerPokemon.dex}.png" onerror="this.style.display='none'">
                </div>
                <div class="pokemon-info">
                    <h3>${battleState.playerPokemon.speciesName}</h3>
                </div>
            `;

            const playerHPPercent = (battleState.playerHP / battleState.playerMaxHP) * 100;
            document.getElementById('player-hp-fill').style.width = playerHPPercent + '%';
            if (playerHPPercent < 30) document.getElementById('player-hp-fill').classList.add('critical');
            else document.getElementById('player-hp-fill').classList.remove('critical');
            document.getElementById('player-hp-text').textContent = `${Math.round(battleState.playerHP)}/${battleState.playerMaxHP}`;

            const playerEnergyPercent = Math.min((battleState.playerEnergy / 100) * 100, 100);
            document.getElementById('player-energy-fill').style.width = playerEnergyPercent + '%';
            document.getElementById('player-energy-text').textContent = `${Math.round(battleState.playerEnergy)}/100`;

            document.getElementById('player-shield-btn').textContent = `Use Shield (${battleState.playerShields})`;

            // Opponent display
            const opponentDisplay = document.getElementById('battle-opponent-display');
            opponentDisplay.innerHTML = `
                <div class="pokemon-sprite" style="border-color: #ff7043;">
                    <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${battleState.opponentPokemon.dex}.png" onerror="this.style.display='none'">
                </div>
                <div class="pokemon-info">
                    <h3>${battleState.opponentPokemon.speciesName}</h3>
                </div>
            `;

            const opponentHPPercent = (battleState.opponentHP / battleState.opponentMaxHP) * 100;
            document.getElementById('opponent-hp-fill').style.width = opponentHPPercent + '%';
            if (opponentHPPercent < 30) document.getElementById('opponent-hp-fill').classList.add('critical');
            else document.getElementById('opponent-hp-fill').classList.remove('critical');
            document.getElementById('opponent-hp-text').textContent = `${Math.round(battleState.opponentHP)}/${battleState.opponentMaxHP}`;

            const opponentEnergyPercent = Math.min((battleState.opponentEnergy / 100) * 100, 100);
            document.getElementById('opponent-energy-fill').style.width = opponentEnergyPercent + '%';
            document.getElementById('opponent-energy-text').textContent = `${Math.round(battleState.opponentEnergy)}/100`;
        }

        function logBattleMessage(message, type) {
            battleState.battleLog.push({ message, type, turn: battleState.turnCount });
            const log = document.getElementById('battle-log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[Turn ${battleState.turnCount}] ${message}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }

        function endBattleVictory() {
            battleState.battleActive = false;
            const duration = Math.round((Date.now() - battleState.startTime) / 1000);

            logBattleMessage('Victory! You won the battle!', 'system');

            progressData.totalBattles++;
            progressData.battleWins++;
            progressData.battlesCompleted.push({
                date: new Date().toISOString(),
                playerPokemon: battleState.playerPokemon.speciesName,
                opponentPokemon: battleState.opponentPokemon.speciesName,
                duration,
                result: 'victory'
            });

            saveProgress();
            updateUI();
        }

        function endBattleDefeat() {
            battleState.battleActive = false;
            const duration = Math.round((Date.now() - battleState.startTime) / 1000);

            logBattleMessage('Defeat! Opponent won the battle.', 'system');

            progressData.totalBattles++;
            progressData.battlesCompleted.push({
                date: new Date().toISOString(),
                playerPokemon: battleState.playerPokemon.speciesName,
                opponentPokemon: battleState.opponentPokemon.speciesName,
                duration,
                result: 'defeat'
            });

            saveProgress();
            updateUI();
        }

        function endBattle() {
            battleState.battleActive = false;
            document.getElementById('battle-setup').style.display = 'grid';
            document.getElementById('battle-arena').style.display = 'none';
        }

        function resetBattle() {
            battleState = {
                playerPokemon: null,
                playerHP: 100,
                playerMaxHP: 100,
                playerEnergy: 0,
                playerShields: 2,
                playerFastMove: null,
                playerChargedMove1: null,
                playerChargedMove2: null,
                opponentPokemon: null,
                opponentHP: 100,
                opponentMaxHP: 100,
                opponentEnergy: 0,
                opponentShields: 2,
                opponentFastMove: null,
                opponentChargedMove1: null,
                opponentChargedMove2: null,
                difficulty: 'easy',
                battleLog: [],
                battleActive: false,
                turnCount: 0,
                startTime: null
            };

            document.getElementById('battle-setup').style.display = 'grid';
            document.getElementById('battle-arena').style.display = 'none';
            document.getElementById('player-pokemon-display').innerHTML = `
                <div class="pokemon-sprite">
                    <span style="color: #64b5f6;">Select Pokemon</span>
                </div>
                <div class="pokemon-info">
                    <p style="color: #999;">None selected</p>
                </div>
            `;
            document.getElementById('opponent-pokemon-display').innerHTML = `
                <div class="pokemon-sprite">
                    <span style="color: #ff7043;">None selected</span>
                </div>
                <div class="pokemon-info">
                    <p style="color: #999;">None selected</p>
                </div>
            `;
        }

        // ===== SCENARIO FUNCTIONS =====
        function startEnergyScenario(num) {
            alert(`Energy Scenario ${num} - Coming in full version!\n\nThis would be an interactive training module focused on energy mechanics.`);
        }

        function startShieldScenario(num) {
            alert(`Shield Baiting Scenario ${num} - Coming in full version!\n\nThis would teach you how to bait shields effectively.`);
        }

        function startMoveCounting() {
            alert('Move Counting Training - Coming in full version!\n\nThis will let you practice predicting charged moves by counting fast moves.');
        }

        function submitMovePrediction() {
            alert('Your prediction has been submitted! Results coming in full version.');
        }

        function startCoverageChallenge(num) {
            alert(`Type Coverage Challenge ${num} - Coming in full version!\n\nYou would answer questions about type effectiveness and team coverage.`);
        }

        // ===== PROGRESS & PERSISTENCE =====
        function saveProgress() {
            localStorage.setItem('trainingProgress', JSON.stringify(progressData));
        }

        function loadProgress() {
            const saved = localStorage.getItem('trainingProgress');
            if (saved) {
                progressData = JSON.parse(saved);
            }
            updateProgressUI();
        }

        function updateProgressUI() {
            document.getElementById('total-battles').textContent = progressData.totalBattles;
            document.getElementById('win-rate').textContent = progressData.totalBattles > 0
                ? Math.round((progressData.battleWins / progressData.totalBattles) * 100) + '%'
                : '0%';

            document.getElementById('progress-battles').textContent = progressData.totalBattles;
            document.getElementById('progress-scenarios').textContent = progressData.scenariosCompleted.length;

            // Skill level calculation
            const totalMetrics = progressData.skillLevels.energy + progressData.skillLevels.shields + progressData.skillLevels.timing + progressData.skillLevels.coverage;
            let skillLevel = 'Beginner';
            if (totalMetrics >= 300) skillLevel = 'Expert';
            else if (totalMetrics >= 200) skillLevel = 'Advanced';
            else if (totalMetrics >= 100) skillLevel = 'Intermediate';

            document.getElementById('progress-level').textContent = skillLevel;

            // Skill bars
            const maxSkill = 100;
            document.getElementById('skill-energy').style.width = Math.min(progressData.skillLevels.energy, maxSkill) + '%';
            document.getElementById('skill-shields').style.width = Math.min(progressData.skillLevels.shields, maxSkill) + '%';
            document.getElementById('skill-timing').style.width = Math.min(progressData.skillLevels.timing, maxSkill) + '%';
            document.getElementById('skill-coverage').style.width = Math.min(progressData.skillLevels.coverage, maxSkill) + '%';

            document.getElementById('skill-energy').textContent = Math.min(progressData.skillLevels.energy, maxSkill) + '%';
            document.getElementById('skill-shields').textContent = Math.min(progressData.skillLevels.shields, maxSkill) + '%';
            document.getElementById('skill-timing').textContent = Math.min(progressData.skillLevels.timing, maxSkill) + '%';
            document.getElementById('skill-coverage').textContent = Math.min(progressData.skillLevels.coverage, maxSkill) + '%';

            // Recent battles
            const recentBattlesList = document.getElementById('recent-battles-list');
            if (progressData.battlesCompleted.length > 0) {
                recentBattlesList.innerHTML = progressData.battlesCompleted
                    .slice(-5)
                    .reverse()
                    .map((battle, idx) => `
                        <div style="padding: 15px; background: rgba(100, 181, 246, 0.05); border-radius: 5px; margin: 10px 0; border-left: 4px solid ${battle.result === 'victory' ? '#4caf50' : '#f44336'};">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <strong>${battle.playerPokemon} vs ${battle.opponentPokemon}</strong>
                                <span style="color: ${battle.result === 'victory' ? '#4caf50' : '#f44336'}; font-weight: 600;">${battle.result.toUpperCase()}</span>
                            </div>
                            <div style="color: #b0bec5; font-size: 0.9em;">Duration: ${battle.duration}s</div>
                        </div>
                    `)
                    .join('');
            }
        }

        function exportProgress() {
            const dataStr = JSON.stringify(progressData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `training-progress-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            showSuccess('Progress exported successfully!');
        }

        function clearProgress() {
            if (confirm('Are you sure you want to reset all training data? This cannot be undone.')) {
                progressData = {
                    totalBattles: 0,
                    battleWins: 0,
                    battlesCompleted: [],
                    scenariosCompleted: [],
                    skillLevels: { energy: 0, shields: 0, timing: 0, coverage: 0 },
                    achievements: [],
                    playtime: 0
                };
                saveProgress();
                updateProgressUI();
                showSuccess('All progress cleared!');
            }
        }

        function toggleBattleLog() {
            const log = document.getElementById('battle-log');
            log.style.display = log.style.display === 'none' ? 'block' : 'none';
        }

        // ===== UTILITY FUNCTIONS =====
        function buildTypeChart() {
            // Simplified type effectiveness (in full version, would be complete matrix)
            return {
                fire: { grass: 1.6, ice: 1.6, bug: 1.6, steel: 1.6, water: 0.625 },
                water: { fire: 1.6, ground: 1.6, rock: 1.6, grass: 0.625 },
                grass: { water: 1.6, ground: 1.6, rock: 1.6, fire: 0.625 },
                electric: { water: 1.6, flying: 1.6, grass: 0.625 },
                ice: { flying: 1.6, ground: 1.6, grass: 1.6, dragon: 1.6 },
                fighting: { normal: 1.6, rock: 1.6, steel: 1.6, ice: 1.6, dark: 1.6 },
                poison: { grass: 1.6, fairy: 1.6, poison: 0.625, ground: 0.625 },
                ground: { fire: 1.6, electric: 1.6, poison: 1.6, rock: 1.6, grass: 0.625 },
                flying: { fighting: 1.6, bug: 1.6, grass: 1.6, electric: 0.625, rock: 0.625 },
                psychic: { fighting: 1.6, poison: 1.6, dark: 0.625 },
                bug: { grass: 1.6, psychic: 1.6, dark: 1.6, fire: 0.625, fighting: 0.625 },
                rock: { flying: 1.6, bug: 1.6, fire: 1.6, ice: 1.6, fighting: 0.625, ground: 0.625 },
                ghost: { ghost: 1.6, psychic: 1.6, normal: 0.390625 },
                dragon: { dragon: 1.6, ice: 0.625, grass: 0.625, fire: 0.625, water: 0.625 },
                dark: { ghost: 1.6, psychic: 1.6, fighting: 0.625, dark: 0.625, fairy: 0.625 },
                steel: { rock: 1.6, ice: 1.6, fairy: 1.6, fire: 0.625, water: 0.625, grass: 0.625, psychic: 0.625, flying: 0.625, rock: 0.625, normal: 0.625, steel: 0.625 },
                fairy: { fighting: 1.6, dark: 1.6, dragon: 1.6, poison: 0.625, steel: 0.625 }
            };
        }

        function updateUI() {
            updateProgressUI();
        }

        function showError(message) {
            const container = document.querySelector('.container');
            const errorBox = document.createElement('div');
            errorBox.className = 'error-box';
            errorBox.textContent = message;
            container.insertBefore(errorBox, container.firstChild);
            setTimeout(() => errorBox.remove(), 5000);
        }

        function showSuccess(message) {
            const container = document.querySelector('.container');
            const successBox = document.createElement('div');
            successBox.className = 'success-box';
            successBox.textContent = message;
            container.insertBefore(successBox, container.firstChild);
            setTimeout(() => successBox.remove(), 5000);
        }

        // ===== APP START =====
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
